:: Layer4 1 [layer4]
<<nobr>>
<<set $currentLayer = 4>>
<<masteraudio stop>>
<<audio "layer4" volume 0.2 play loop>>
<<set $timeL3T1 = 0, $timeL3T2 = 0>>
<<set $timeL4T1 = 0>>
<</nobr>>\
\
@@.layerTitle;
[img[setup.ImagePath+'Layer Intros/l4intro.png']]
!Layer 4 - Hoarfrost Wastes
@@You finally emerge from the tunnels of the third layer and are given the least warm greeting to the fourth possible: a blast of chilling air that you feel settling into your bones near-instantly. Eyes adjusting once more to the miasmal light, your first look at the layer is of a blanket of snow extending far into the fog-covered horizon, punctuated by small glacial mountains as the ground slowly meanders downward. miasma-produced winds sometimes dislodge buildups of ice on the ceiling, causing it to drift down to the ground as snow or hail. What little vegetation there is struggling to survive in this layer grows small and sparse.

This layer is enveloped in a bitter, piercing cold, strengthened by Miasma to effectively penetrate any kind of insulating clothing or similar protection. Your only option for staying warm is an active source that radiates heat. Without something easily portable, like a torch, you'll need to frequently stop to take shelter to start campfires. If you have a portable heat source, you may subtract 2 days from all time costs on this page. The 5 Rømer Stones together don't quite produce enough heat to keep you warm on their own.

<<nobr>>
<<if $visitL4 === 0>>
<button class="dark-btn obsidian" data-passage="Layer4 Spectre">Walk through the fourth layer of the Abyss</button><br>
	<<if $hiredCompanions.some(e => e.id === setup.companionIds.cherry)>>
		<br><button class="dark-btn obsidian" data-passage="Layer4 Cherry">Use Cherry's chaotic luck</button>
	<</if>>
<<else>>
<button class="dark-btn obsidian" data-passage="Layer4 Hub">Walk through the fourth layer of the Abyss</button><br>
<</if>>
<</nobr>>

:: Layer4 Spectre

[img[setup.ImagePath+'Threats/spectreoftheend.png']]

Despite your attempts to resist the cold, an unsettling sensation takes hold, as if unseen eyes scrutinize your every move.

As you trudge through the snow, the feeling of being watched intensifies. You glance over your shoulder, desperate to catch a glimpse of your elusive pursuer. Then, out of the corner of your eye, you see her: a spectral figure, the embodiment of darkness. Her form is that of a young girl with a single, haunting red eye that never quite meets your gaze.

She stands at the edge of your peripheral vision, immaterial and seemingly harmless. Her presence, however, sends shivers down your spine. Though she never makes a sound, you can feel the weight of her gaze, the promise of both pleasure and doom lurking in the shadows.

<button class="dark-btn obsidian" data-passage="Layer4 Hub">Walk through the fourth layer of the Abyss</button>

:: Layer4 Hub [layer4 hub]
<<nobr>>
<<set $currentLayer = 4>>
<<if !isPlaying("layer4")>>
	<<masteraudio stop>>
	<<audio "layer4" volume 0.2 play loop>>
<</if>>
<<CarryAdjust>><<checkTime>>
<<if $visitL4 === 0>>
	<<set $endSpectre = $time>>
	<<set $visitL4 = 1>>
	<<set $layerTemp = 8>>
<<elseif $secondVisitL4 === 0>>
	<<set $secondVisitL4 = 1>>
	<<set $layerTemp = 18>>
<<else>>
	<<set $layerTemp = random(0,20)>>
<</if>>
<<if $layerTemp === 1 && setup.haveColdProtection>>
	As you trudge through the snow, you suddenly feel a gust of wind pick up, and a flurry of snowflakes swirl around you. The miasma-enhanced cold bites at your skin, and you struggle to maintain visibility. You quickly reach for your heat source, igniting it with a flare of heat that temporarily pushes the biting cold away. The storm subsides just as quickly as it began, but you're reminded of the harsh reality of this layer of the Abyss. <br><br>
<<elseif $layerTemp === 2>>
	A sudden flurry of Miasma-driven hail pelts down on you, each icy stone biting into your exposed skin. You take shelter behind a nearby glacier, watching as the hailstorm intensifies. Just as you're about to leave your hiding place, you notice a small, crystalline creature darting in and out of the hailstones, seemingly unaffected by the storm. Its delicate, ice-like body refracts the Miasma's light, creating a mesmerizing dance of colors. Once the hailstorm subsides, the creature disappears into the snowy landscape.<br><br>
<<elseif $layerTemp === 3>>
	As you trudge through the thick snow, you notice a cluster of frostbitten flowers, their petals a haunting shade of deep blue. As you lean in to inspect them, you feel a strange warmth emanating from them. Curious, you cautiously touch one of the petals, and your fingertips are met with a tantalizing heat, a stark contrast to the surrounding cold.<<if $abyssKnow === 1>> Upon closer inspection, you find that these flowers are a rare species known as Heatblooms, which generate warmth to survive in the harsh conditions. Unfortunately, they aren't useful for warming people, as they will only generate warmth in the harsh cold of the storm. Once you bring them close to your body, they'll become as inert as any other flower.<</if>><br><br>
<<elseif $layerTemp === 6 && $mc.hasCurse(HijinksEnsue)>>
	<<include "Hijinks Ensue Scenes">>
<<elseif $layerTemp >= 18 - (1+$hiredCompanions.length) && $layerTemp < 19 && ($hiredCompanions.length > 0  || $ownedRelics.some(e => e.name === "Creepy Doll") )>>
	<<include "Companion Layer Interaction">>
<<elseif $layerTemp >= 19>>
	<<include "Curse Descriptions">><br><br>
<<else>>
	The deep, penetrating cold of this layer chills you to the bone as you explore. Snow drifts gently to the ground around you, and everywhere you look seems to be coated in either a powder of snow or a layer of clear, frozen ice. Your only relief is when you rest at camp to eat, drink, and enjoy the warmth of your campfire.<br><br>

	This layer is enveloped in a bitter, piercing cold, strengthened by Miasma to effectively reach through any kind of insulating clothing or similar protection. Your only option for staying warm is an active source that radiates heat. Without something easily portable, like a torch, you'll need to frequently stop to take shelter to start campfires. If you have a portable heat source, you may subtract 2 days from all time costs on this page. The 5 Rømer Stones together don't quite produce enough heat to keep you warm on their own.<br><br>
<</if>>

<<if $slwear>>
	It's a strange experience to see a world of howling winds that carry thick snow, which should make you feel a blistering cold, yet you aren't bothered by it in the slightest. Your Solace Lace apparently does it job marvelously.
<<elseif $warmCloth && !$dollevent2 && !$mc.hasCurse(ClothingRestrictionC)>>
	You put on the self-warming winter clothes. The Rømer Stones give off a small amount of heat at the locations where you incorporated them in the gear. At first you still feel cold, but eventually the insulation does its job trapping the heat and you feel quite comfortable in it.<br><br>
<<else>>

	<<if $dollevent2 && $warmCloth>>
		By now you've accepted that you can't take off the tattered pink dress. But when you try to put the self-warming winter clothes over your tattered dress you faint, only to wake up with the winter clothes off and neatly folded in your hands again. Looking at the doll you swear you can see it grinning at you. It seems you are stuck using other sources of heat. If only you could burn that accursed doll...<br><br>

	<<elseif $dollevent2 && !$warmCloth>>
		Dressed in only your tattered pink dress, you shiver from the freezing cold. You wish you had something warmer to wear. At the same time you wonder if you could even wear something warmer now that you are in this Cursed dress. Damn that doll..<br><br>
	
	<<elseif $mc.hasCurse("Clothing Restriction C")>>
		Without any clothing on you feel the icy wind cut through you the moment step into the layer. Instantly you find it hard to even move with the freezing cold assualting your body.<br><br>
	<</if>>

	<<if $items[9].count > 0 && !setup.haveColdProtection && $torchUse === 0>>
	<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$torchUse = 1">Use torches to reduce travel times on this layer by 2 days each at the cost of 1 torch per travel</button><br><br>
	<</if>>
	<<if $torchUse === 1 && !setup.haveColdProtection>>
	<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$torchUse = 0">Stop using torches to reduce travel time</button><br><br>
	<</if>>

<</if>>

<<if !isPlaying("layer4")>>
	<<masteraudio stop>><<audio "layer4" volume 0.2 play loop>>
<</if>>
What do you want to do while you're here?<br>
<br>
<div class="options-container">
  <div>
    <div class="category-header">Organization</div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Use Items and Relics">
          <span class="icon">[img[setup.ImagePath+'Icons/useitems.png']]</span> Items and Relics
        </button>
      </div>
      <<if $hiredCompanions.length > 0>>
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Party overview">
          <span class="icon">[img[setup.ImagePath+'Icons/partytalk.png']]</span> Your Party <<CheckParty>>
        </button>
      </div>
      <</if>>
    </div>
  </div>
  <div>
    <div class="category-header">Layer Preparations</div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Threats">
          <span class="icon">[img[setup.ImagePath+'Icons/threats.png']]</span> Threats
        </button>
      </div>
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Forage">
          <span class="icon">[img[setup.ImagePath+'Icons/foraging.png']]</span> Foraging
        </button>
      </div>
    </div>
  </div>
  <div>
    <div class="category-header">Curses and Relics</div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Curses">
          <span class="icon">[img[setup.ImagePath+'Icons/curses.png']]</span> Curses
        </button>
      </div>
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Relics">
          <span class="icon">[img[setup.ImagePath+'Icons/relicsearch.png']]</span> Relics
        </button>
      </div>
    </div>
  </div>
  <div>
    <div class="category-header">Places</div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Wonders">
          <span class="icon">[img[setup.ImagePath+'Icons/wonder.png']]</span> Wonders
        </button>
      </div>
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Camp">
          <span class="icon">[img[setup.ImagePath+'Icons/camping.png']]</span> Camp
        </button>
      </div>
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Habitation">
          <span class="icon">[img[setup.ImagePath+'Icons/layer4habitation.png']]</span> Habitation
        </button>
      </div>
    </div>
  </div>
  <div>
    <div class="category-header">Travel</div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Ascend 1">
          <span class="icon">[img[setup.ImagePath+'Icons/ascent.png']]</span> Ascend
        </button>
      </div>
    </div>
    <div class="options-grid">
      <div class="menu-item">
        <button class="dark-btn obsidian text-center" data-passage="Layer4 Exit1">
          <span class="icon">[img[setup.ImagePath+'Icons/descent.png']]</span> Descend
        </button>
      </div>
    </div>
  </div>
</div>
<</nobr>>


:: Layer4 Cherry [layer4]
[img[setup.ImagePath+'Surface/cherry.png']]

How would you like to use Cherry's chaotic luck ability?

<<nobr>>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Cherry Relic">Get 2 random Relics for half cost</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Cherry Curse">Get 2 random Curses for +50% corruption</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Cherry Mix">Get 1 Relic and 1 Curse</button>
</div>
<</nobr>>


:: Layer4 Threats [layer4 cards nobr]
<h1>Threats</h1>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>

<<ThreatGrid setup.driftingSwallower setup.spectreoftheEnd>>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>


:: Layer4 Forage [cards layer4]

<h1>Foraging</h1>

<p>If you decide to start foraging for food or water, it means that you will not consume your stored food rations or water supply while consuming time on tasks in this layer, but you will not obtain more supplies by starting to forage here.</p>
<<if $mc.heightDir === 0 && $forageFood === 1>>
	<<set _heightDirEvent = new HeightDirectionEvent()>>
	<<set $mc.events.push(_heightDirEvent)>>
	<p>Would you like to increase or decrease your height due to eating flairabou meat?<br><br>

	<<radiobutton "_heightDirEvent.heightDirection" -1 checked>> Decrease
	<<radiobutton "_heightDirEvent.heightDirection" 1 >> Increase</p>
<</if>>
<<nobr>>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring the rest of the layer</button></p>

<<ForagingGrid setup.flairabou setup.algalMeltwater>>

<<if $items[2].count > 0>>
<p><button class="dark-btn obsidian" data-passage="Layer4 Flasks">Fill your empty flasks with water from the layer</button></p>
<</if>>
<p><<if $slingshot>>
	<button class="dark-btn obsidian" data-passage="Layer4 Forage" data-setter="$mc.events.push(new HeightEvent("Flairabou Major", 3));$foodL4 += 1">Hunt and consume Flairabou once</button><br>
<<elseif $items[13].count && $items[20].count >= Math.max(2 - $bullRed, 1)>>
	[[Hunt and consume Flairabou once|Layer4 Forage][$mc.events.push(new HeightEventPercent("Flairabou Major", 1.8));$foodL4 += 1;$items[20].count -= Math.max(2 - $bullRed, 1)]]
<</if>>
<<if $abyssKnow>>
	<<if $slingshot>>
		<button class="dark-btn obsidian" data-passage="Layer4 Forage" data-setter="$mc.events.push(new HeightEvent("Flairabou Minor", 0.5));$foodL4 += 1">Hunt and consume carefully prepared Flairabou once</button><br>
	<<elseif $items[13].count && $items[20].count >= Math.max(2 - $bullRed, 1)>>
		[[Hunt and consume carefully prepared Flairabou once|Layer4 Forage][$mc.events.push(new HeightEventPercent("Flairabou Minor", 0.3));$foodL4 += 1;$items[20].count -= Math.max(2 - $bullRed, 1)]]
	<</if>>
<</if>>
<button class="dark-btn obsidian" data-passage="Layer4 Forage" data-setter="$algalSize += 1;$waterL4 += 1">Consume water from melted snow once</button></p>
<</nobr>>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring the rest of the layer</button></p>


:: Layer4 Relics [layer4 cards nobr]
<p><<CarryAdjust>><<checkTime>></p>

<h1>Relics</h1>

<p>
@@.floatr;[img[setup.ImagePath+'icon.png']]@@

The Brave Vector Relic you can find here is a perfect example of something you might want the Relic Workshop to modify on the surface. With a few simple modifications, it could work as a kind of debris gun, firing whatever rocks and rubble you can find down here at high velocity towards enemies... or perhaps even other Relics, though you would need to be quite careful to ensure that fired Relics don't break upon impact. 
</p>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>

<<RelicGrid `setup.relicsOnLayer[4]`>>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>


:: Layer4 Curses [layer4 cards nobr]
<<CarryAdjust>>

<h1>Curses</h1>

<<if $escBalDepl===0>>\
	<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button></p>
<<else>>\
	<p><button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button></p>
<</if>>

<<CurseGrid `setup.cursesOnLayer[4]`>>

<<if $escBalDepl===0>>
	<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button></p>
<<else>>
	<p><button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button></p>
<</if>>


:: Layer4 Wonders [layer4 cards nobr]
<h1>Wonders</h1>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>

<<WonderGrid setup.steadyShrine setup.purityTree>>

<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button></p>


:: Layer4 Habitation [Layer4 cards nobr]
<h1>Habitation</h1>

<<if !$AgeEndReached>>
	<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue your business on the Fourth Layer</button></p>
<</if>>

<<set _ending = "Habitation Ending">>

<<HabitationGrid setup.habitationL4>>

<<if !$AgeEndReached>>
	<p><button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue your business on the Fourth Layer</button></p>
<</if>>

:: Layer4 Ascend 1 [layer4]
<<nobr>>
<<ascensionCosts>>
In order to backtrack through the caverns up to layer <<print ($currentLayer - 1)>>, you must pay 
<<if $currentModifiedAscensionCost !== $currentAscensionCost>>
    <s>$currentAscensionCost</s> <<print $currentCostStyle + $currentModifiedAscensionCost + ($currentCostStyle ? "@@" : "")>>
<<else>>
    $currentAscensionCost
<</if>>
 corruption points and travel for 
<<if $currentModifiedTimeCost !== $currentTimeCost>>
    <s>$currentTimeCost</s> <<print $currentTimeStyle + $currentModifiedTimeCost + ($currentTimeStyle ? "@@" : "")>>
<<else>>
    $currentTimeCost
<</if>>
 <<print $currentModifiedTimeCost === 1 ? "day" : "days">>.
<<if $ascendedLayers.includes($currentLayer)>>
    <br><br>You've ascended from this layer before, so the base corruption cost is reduced from <<print _firstTimeCosts[$currentLayer]>> to <<print _subsequentCosts[$currentLayer]>> due to your minor acclimation to the miasma here.
<</if>><br><br>

If you wanted to ascend all the way to the surface, it would cost 
<<if $totalModifiedAscensionCost !== $totalAscensionCost>>
    <s>$totalAscensionCost</s> <<print $totalCostStyle + $totalModifiedAscensionCost + ($totalCostStyle ? "@@" : "")>>
<<else>>
    $totalAscensionCost
<</if>>
 corruption points.
<</nobr>>

<<if $DaedalusEquip>>\
	<<if !$DaedalusFly>>\
		You are currently committed to simply walking to the next layer
		<button class="dark-btn obsidian" data-passage="Layer4 Ascend 1" data-setter="$DaedalusFly=true">Flap your wings and prepare to fly to the next layer</button>
	<<else>>\
		You are about to fly to the next layer
		<button class="dark-btn obsidian" data-passage="Layer4 Ascend 1" data-setter="$DaedalusFly=false">Maybe it's better to walk to the next layer</button>
	<</if>>\
<</if>>\
<span class="icon">[img[setup.ImagePath+'Icons/ascent.png']]</span>&nbsp;<button class="dark-btn obsidian" data-passage="Layer4 Ascend2">Continue your ascent</button>

<span class="icon">[img[setup.ImagePath+'Icons/return.png']]</span>&nbsp;<button class="dark-btn obsidian" data-passage="Layer4 Hub">Turn back and continue your business on the fourth layer</button>


:: Layer4 Exit1 [layer4]
Between this layer and the next is a kilometers-long sheer drop with a near-featureless wall of slippery wall of rock and ice on all sides. Paths and tunnels onward to the next layer exist, but they're very slow and meandering, and taking these down to the next layer, combined with the time trekking through the main body of this layer, will take 19 days by default. If you have rope with you, you can instead descend right through this dividing space in a much shorter time, and the whole trip will only take 8 days by default. Remember that the return trip takes longer than the trip down, either way.

<<if setup.haveRope>>\
You <b>have a rope</b>, so it will take you <<descentTime>> days.
<<else>>\
You <b>don't have a rope</b>, so the journey will be very long, taking <<descentTime>> days.
<</if>>\

The air seems to get drier as you proceed further down. You might want to stockpile plenty of water before continuing on, probably around 2 weeks worth at a minimum.

<span class="icon">[img[setup.ImagePath+'Icons/return.png']]</span>&nbsp;<button class="dark-btn obsidian" data-passage="Layer4 Hub">Turn back and continue your business on the fourth layer</button>

<span class="icon">[img[setup.ImagePath+'Icons/descent.png']]</span>&nbsp;<<TravelToPassageButton 'Continue your descent to the fifth layer' 'Layer4 Exit2' `setup.haveRope ? 8 : 19` 0 1 0 'dark-btn obsidian'>>


:: Take on Libido Reinforcement C [layer4]
<<set _curse = new LibidoReinforcementC()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

<<include "Libido Curse">>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Lactation Rejuvenation A [layer4]
<<set _curse = new LactationRejuvenationA()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you wander through the fourth layer, a sudden warmth blooms from within, a soothing contrast to the icy realm you are immersed in. The Curse takes hold, its presence as unexpected as it is unsettling. Lactation. A personal, intimate change that seems incongruous with the harsh Abyss you navigate.

The sensation is foreign, yet not entirely uncomfortable. A gentle pressure builds within your chest, radiating a tender warmth that pulses in sync with your heartbeat. Subtle dampness permeates your insulating clothing. You look down, seeing the faint dark spots bloom against the fabric of your garments, the physical manifestation of this ethereal curse.

Panic flutters briefly in your heart. In the midst of this desolate, freezing environment, a condition like this is an unexpected twist. Yet, the more you consider it, the more you realize it isn't entirely a disadvantage. Perhaps this heat radiating from within can serve as an unexpected bulwark against the bitter cold. An aberration from the norm, no doubt, but a potential advantage in the relentless cold of the Abyss. The Abyss is a crucible of adaptability, after all.

As you continue your descent into the frost-bitten depths, you ponder your situation, a curious mixture of anticipation and apprehension. How will this affect your journey? How will you manage the necessities of this new condition, milking and all? You aren't sure. But, in the face of the Abyss, you have no choice but to adapt, to evolve.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Asset Robustness D [layer4]
<<set _curse = new AssetRobustnessD()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
<<CarryAdjust>>\
[img[setup.ImagePath + _curse.pic]]

<<if $mc.penisCor>0 && $mc.breastsCor===0 >>\
	The intensity of this Curse is stronger than you were expecting. Your penis springs to full erection, and then bulges ever larger. The base, the shaft, the tip start swelling to an alarming degree. Drops of precum start oozing out of the tip, but the growing doesn't stop. Then, finally, the Curse releases its grip, but you stare slack-jawed as you realize you're now sporting a $mc.penisCor inch long dong. The erection lasts for a little while longer, but dealing with a member this large without it tripping up your legs is going to require some practice. You grimace at a slight pinching sensation as you hobble forward
<<elseif $mc.penisCor===0 && $mc.breastsCor>0>>\
	The intensity of this Curse is stronger than you were expecting. Your nipples jut out like pencil erasers and small dribbles of milk start to come out of them as an intense pressure and a stretching sensation fills your breasts.

	The swelling of your boobs is straining against the skin, making them temporarily as taut as inflated balloons. The skin seems to be expanding to accommodate the mass that is swelling in your breasts, but then the dribbles of milk turn into three intense squirts before the experience seems to have come to an end. You gape down at your new breasts that have grown a whopping 8 cup sizes, to a $mc.breastsLabel cup, and even your heavy breathing is sending rippling quivers into them. Do they even make bras that can accommodate what your tits have become? Surely they must, but you feel off balance as you teeter forward.
<<else>>\
	You are overwhelmed by sensation as the Curse grips you, and you fall to the ground. Your back arches as your penis springs to full erection, and bulges ever larger. Your nipples jut out like pencil erasers and small dribbles of milk start to come out of them as an intense pressure and a stretching sensation fills your breasts. The base, the shaft, the tip of your penis are swelling to an alarming degree and drops of precum start oozing out of the tip. As your breasts swell to gargantuan proportions, the dribbles of milk turn into periodic gushes.

	Then, finally, the Curse releases its grip. You stare slack-jawed down at yourself you realize you're now sporting a $mc.penisCor inch long dong which throbs in time with your pulse between your two heaving $mc.breastsLabel cup breasts. This is a pretty large change to your body. You just lie there on the ground for a minute coming to grips with what has just happened to you.
<</if>>\

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Age Reduction B [layer4]
<<set _curse = new AgeReductionB()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

<<include "Age Reduction Scene">>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Sleep Tight [layer4]
<<set _curse = new SleepTight()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you venture through the fourth layer, you suddenly feel a strange sensation taking over your body. It starts as a slight drowsiness, your eyelids feeling heavier with every passing moment. It's a strange sensation to experience in the midst of the piercing cold and icy winds. Your mind briefly wonders if it's the effect of the Miasma, but there's something different about this fatigue, something more permanent.

You can't help but be curious about this newfound drowsiness, and you decide to pause for a moment and examine yourself. The exhaustion intensifies, your limbs growing heavy and sluggish, as if you're being pulled into the depths of sleep. You find yourself pondering how this mysterious Curse will affect your life in the Abyss.

You're struck by the realization that you'll need to sleep for 12 hours a day, a daunting prospect in this harsh environment. But then, an unexpected warmth envelops you, a soothing sensation that seems to promise safety and comfort in your slumber. You find yourself longing for that embrace, eager to experience the pleasure that comes from such deep, restful sleep.

You know that this Curse could make your journey through the Abyss more challenging, as you'll need to find a safe haven for those long hours of sleep. But at the same time, you can't help but be intrigued by the idea of such exquisite rest, especially in a place so bereft of comfort.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Sweet Dreams [layer4]
<<set _curse = new SweetDreams()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As night descends upon the Abyss, you prepare yourself for the restless slumber that awaits you. Despite the layers of insulating clothing you wear, the chilling cold still manages to touch your skin, but your thoughts are consumed by the anticipation of the vivid, erotic nightmares that are now part of your reality.

You finally surrender to sleep, and almost immediately, the dreams begin.

You find yourself in a dimly lit room, where the air is heavy with the intoxicating scent of lust and an underlying sense of danger. The walls seem to pulse with a rhythm that matches your heartbeat, and the space itself feels vast and infinite. Shadows dance at the edges of your vision, their movements sinuous and sensual, enticing you to follow them deeper into the darkness.

Soft, sultry whispers caress your ears, voices that are both familiar and foreign. They speak of forbidden pleasures and haunting fears, weaving a seductive web that ensnares your mind, holding you captive. The whispers grow louder, more insistent, and you feel yourself drawn irresistibly towards the shadows.

As you move closer, the shadows morph into alluring, otherworldly creatures that touch and tease your body. Their fingers, cold as ice, trace patterns on your skin, eliciting a searing heat within you that stokes an insatiable hunger.

The shadowy figures take shape, their forms shifting and changing, blending beauty with terror. Their touches are both exquisite and frightening, as they explore your body with a sense of hunger that mirrors your own.

These ethereal beings caress your most intimate areas, their ghostly fingers gliding with expert precision, leaving behind a tingling sensation that begs for more. Your senses are overwhelmed, each touch sending shivers down your spine and moans escaping your lips.

As the creatures continue their relentless seduction, you feel yourself being pushed to the edge of release. The pleasure intensifies, building to a fever pitch, until you find yourself caught between the terrifying unknown and the ecstasy of ultimate pleasure.

But just as you think you can bear no more, the creatures vanish, leaving you alone in the darkness, panting and trembling from head to toe. The room seems to expand around you, and the whispers dissipate, replaced by an unnerving silence.

You jolt awake, your body slick with sweat and your own fluids, and your heart racing in your chest. This will be what every night is like for you from now on.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Hypno Happytime [layer4]
<<set _curse = new HypnoHappytime()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

You zone out for a moment, stopping in your tracks as a haze passes through your mind. It lasts for only a few moments, but leaves a permanent effect on your mind.

You know that from now on you are much more easily influenced and are particularly to any methods of propaganda, brainwashing, or hypnotism. Maybe you should keep someone you trust nearby to keep you safe from anyone who would want to exploit a vulnerable <<PerceivedGender $mc>> such as yourself. Try not to get into any situation where anyone is trying to convince you of something you don't want to believe. You have a feeling that if someone got you to come to an MLM sales meeting, you might leave without your life savings.

<b>Warning: This may make mental hazards deeper in the Abyss much more dangerous!</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Crossdress Your Heart [layer4]
<<set _curse = new CrossdressYourHeart()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

<<if $mc.vagina > 0>>\
	As you trudge deeper into the frostbitten expanse of the fourth layer of the Abyss, an invisible force suddenly strikes you. Your heart skips a beat, and an unnatural chill races through your body. An overwhelming compulsion to remove your feminine attire floods overwhelms you, and your mind is plagued with a deep, visceral aversion to them.

	Your thoughts spiral, and you can't concentrate on anything but the intense need to cast off your clothes. Despite the piercing cold, you find yourself stripping down, leaving your body exposed and shivering as you shed your female clothing. Your mind races as you contemplate how this newfound aversion will impact your life.

	Nude and shivering in the merciless environment, you desperately search for warmth and protection. In the distance, you spot a small, icy cave, and quickly make your way toward it. Inside, you find a heap of discarded clothing—masculine, sturdy, and utilitarian in design. Urgency and yearning swell up within you, a stark contrast to your previous revulsion.

	You cautiously put on the rugged pants, shirt, and boots, finding an unexpected sense of comfort in the coarse, masculine material. Your mind starts to adjust to the changes, but uncertainty still lingers. As you gaze down at your new appearance, you question how this will alter your future interactions, relationships, and self-image.
<<else>>\
	As you slowly venture further into the icy landscape of the fourth layer of the Abyss, you feel the sudden impact of an unseen force. Your heart skips a beat, and an unnatural chill races through your body. An inexplicable urge to remove your masculine clothes overcomes you, and your mind is plagued with a deep, visceral aversion to them.

	Your thoughts become muddled, and you struggle to focus on anything but the overwhelming desire to shed your clothes. Amidst the bitter cold, you find yourself stripping down, your body shivering as you discard your male attire. Your mind races as you ponder how this newfound aversion will affect your life.

	Naked and freezing in the hostile environment, you desperately search to find warmth and protection. In the distance, you spot a small, icy cave, and hurriedly make your way toward it. Inside, you discover a pile of abandoned clothing—feminine, delicate, and intricate in design. Desperation and longing well up inside you, a surprising contrast to your earlier aversion.

	You hesitantly don the frilly dress, stockings, and high-heeled boots, feeling strangely at ease in the soft, feminine fabric. Your mind starts to adjust to the changes, but uncertainty still lingers. As you look down at your new appearance, you wonder how this will alter your future interactions, relationships, and self-image.
<</if>>\

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Lie Detector [layer4]
<<set _curse = new LieDetector()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you traverse the desolate terrain of the fourth layer, you suddenly feel an odd sensation in your mind, as if an invisible force is wrapping around your thoughts. The sensation grows more intense, and you struggle to maintain your footing on the slippery ground. You pause, your breath coming out in misty puffs, as you attempt to comprehend this strange feeling.

Your thoughts, previously private and guarded, now feel exposed and vulnerable. It is as though a veil has been lifted, revealing your deepest secrets and emotions. A sense of dread washes over you as you realize the implications of this newfound vulnerability.

The Curse is insidious in its subtlety; there is no physical manifestation, no apparent change to your appearance. Instead, it strikes at the core of your being, leaving your thoughts and intentions open for others to perceive. With each person you encounter, you will be unable to conceal your true feelings, your desires, your fears. They will know your secrets, your lies, your hidden truths.

As you continue your exploration, you can't help but contemplate how this Curse will affect your future. Relationships will be tested, alliances may crumble, and trust will be a luxury you can no longer afford. The weight of your own honesty may become a burden too heavy to bear.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Megadontia [layer4]
<<set _curse = new Megadontia()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you continue to explore the fourth layer of the Abyss, you become increasingly aware of a growing sensation in your mouth. A tingling sensation, at first subtle but steadily growing more intense, draws your focus inward. The biting cold of the miasma-charged winds whipping against your body fades into the background, as your attention is fully captured by the changes occurring within you.

The tingling sensation shifts to a throbbing ache in your gums, which slowly turns into an intense pressure. You struggle to maintain your composure as you feel your teeth shifting and changing. The pain is both discomforting and, somehow, oddly sensual. Your breathing becomes heavier, and a soft moan escapes your lips, betraying the pleasure you find amidst the pain.

As the transformation continues, you can feel your teeth growing and sharpening. The sensation of your tongue exploring these newly-formed points sends shivers down your spine, their deadly sharpness igniting a primal sense of power within you. The pain begins to subside, replaced by a newfound awareness of the dangerous tools now housed within your mouth.

Your lips part, revealing two especially large teeth, their tips just barely visible when your mouth is closed. The sight of your reflection in a nearby shard of ice is intoxicating, and you can't help but admire the wickedly seductive look these fangs bestow upon you. The perpetual smug-fang appearance suits you perfectly, adding an air of dark allure to your previously unassuming visage.

As you experiment with your newly-acquired teeth, biting down on a piece of leather from your gear, you realize the immense strength they possess. A sudden, powerful desire to use them courses through you, though you know you must be cautious not to harm any potential partners. The thought of restraining this newfound power only serves to fuel your excitement further.

<<include "Inhumanity Warning">>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Softie [layer4]
<<set _curse = new Softie()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>><<CarryAdjust>>\
[img[setup.ImagePath + _curse.pic]]

<<if $mc.penisCor>0 && $mc.breastsCor===0 >>\
	As you take the Curse, wave of dull energy creeps up from the ground, numbing and weighing down your legs. It reaches for your defenseless penis, and suddenly, there's a void where sensation once was. Your penis is more than flaccid; it's inert. 
	
	You try to engage the muscles that once gave it life, but you're met with emptiness. Your penis is unresponsive, yet hypersensitive to your touch, like an appendage you can feel but have no control over. The realization that your flaccid member is now permanent is crushing. 
	
	You mourn the loss of conventional sex and consider exploring unconventional methods to satisfy your desires.
<<elseif $mc.penisCor===0 && $mc.breastsCor>0>>\
	As you take the Curse, a dull wave of energy washes over your shoulders, sinking into your breasts with a tingling sensation. You gasp as your nipples are pulled inwards, disappearing into your chest. Curious, you reach a finger to pull one of them out, and a vulnerable, intimate feeling washes over you. 
	
	Despite your efforts, your nipple remains entirely soft and inverted. Your breasts now resemble doughnuts more than domes, and a mischievous thought crosses your mind, wondering how various objects would feel pressed into the crevices on your chest. Shaking your head to clear the thought, you realize that breastfeeding would be quite a challenge, though not entirely impossible if someone were to clamp their mouth around a wide area and probe inward with their tongue. 
	
	Your areolae now lie hidden within your breasts, and any bras you wear will likely mold to the new shape. The Curse's sensations fade quickly, but the damage is done.
<<elseif $mc.penisCor>0 && $mc.breastsCor>0>>\
	As you take the Curse, wave of dull energy creeps up from the ground, numbing and weighing down your legs. It reaches for your defenseless penis, and suddenly, there's a void where sensation once was. Your penis is more than flaccid; it's inert. 
	
	You try to engage the muscles that once gave it life, but you're met with emptiness. Your penis is unresponsive, yet hypersensitive to your touch, like an appendage you can feel but have no control over. The realization that your flaccid member is now permanent is crushing. 
	
	You mourn the loss of conventional sex and consider exploring unconventional methods to satisfy your desires.

	Next, you feel the energy washing over your shoulders, sinking into your breasts with a tingling sensation. You gasp as your nipples are pulled inwards, disappearing into your chest. Curious, you reach a finger to pull one of them out, and a vulnerable, intimate feeling washes over you.
	
	Despite your efforts, your nipple remains entirely soft and inverted. Your breasts now resemble doughnuts more than domes, and a mischievous thought crosses your mind, wondering how various objects would feel pressed into the crevices on your chest. Shaking your head to clear the thought, you realize that breastfeeding would be quite a challenge, though not entirely impossible if someone were to clamp their mouth around a wide area and probe inward with their tongue. 
	
	Your areolae now lie hidden within your breasts, and any bras you wear will likely mold to the new shape. The Curse's sensations fade quickly, but the damage is done.
<</if>>\

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Hard Mode [layer4]
<<set _curse = new HardMode()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>><<CarryAdjust>>\
[img[setup.ImagePath + _curse.pic]]

<<if $mc.penisCor>0 && $mc.breastsCor===0 >>\
	A wave of energy creeps up from the ground, causing your legs to tingle. Your anticipation heightens as it approaches your vulnerable penis. 
	
	Before the energy even reaches it, your member twitches to life, and upon contact, you're instantly harder than ever. The sensation is a blend of soothing caress and electrifying jolts of pleasure. As the energy courses through your groin, you gasp, feeling as if your penis is ensnared by pulsating threads of energy. 
	
	The sensation seeps into your skin, leaving you with a perpetual erection. You start to adjust to the unrelenting arousal, but the realization that this will never subside is daunting. With a constant, raging erection, you'll need to find a way to navigate life while maintaining your dignity. A spacious codpiece might do the trick. 
	
	Glancing down, you notice a small smear of precum leaking from your member. 

<<elseif $mc.penisCor===0 && $mc.breastsCor>0>>\
	A wave of energy ripples down your shoulders and pools around your breasts. It seeps into your areolae, swirling around your nipples and making them more erect than ever before. 
	
	The energy doesn't dissipate but lingers beneath your skin, causing a constant tingling sensation. You gaze down at your permanently erect nipples and wonder if they've grown slightly. The persistent arousal and heightened sensitivity will make walking through the Abyss an incredibly distracting endeavor. 
	
	You might need to invest in something to prevent chafing and protect your sensitive peaks.

<<elseif $mc.penisCor>0 && $mc.breastsCor>0>>\
	A wave of energy creeps up from the ground, causing your legs to tingle. Your anticipation heightens as it approaches your vulnerable penis. 
	
	Before the energy even reaches it, your member twitches to life, and upon contact, you're instantly harder than ever. The sensation is a blend of soothing caress and electrifying jolts of pleasure. As the energy courses through your groin, you gasp, feeling as if your penis is ensnared by pulsating threads of energy. 
	
	The sensation seeps into your skin, leaving you with a perpetual erection. You start to adjust to the unrelenting arousal, but the realization that this will never subside is daunting. With a constant, raging erection, you'll need to find a way to navigate life while maintaining your dignity. A spacious codpiece might do the trick. 
	
	Glancing down, you notice a small smear of precum leaking from your member. 

	Next, A second wave ripples down your shoulders and pools around your breasts. It seeps into your areolae, swirling around your nipples and making them more erect than ever before. 
	
	The energy doesn't dissipate but lingers beneath your skin, causing a constant tingling sensation. You gaze down at your permanently erect nipples and wonder if they've grown slightly. The persistent arousal and heightened sensitivity will make walking through the Abyss an incredibly distracting endeavor. 
	
	You might need to invest in something to prevent chafing and protect your sensitive peaks.
	
<</if>>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Lingual Leviathan [layer4]
<<set _curse = new LingualLeviathan()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

Suddenly, your mouth feels unbearably full, making it difficult to breathe. Overwhelmed by the sensation, as if a foreign object is lodged in your throat, you instinctively reach for your mouth, desperate to alleviate the pressure. Upon touching it, you're struck by a mix of shock and fascination – your tongue has grown to an astonishing 30 centimeters in length.

The Lingual Leviathan Curse has taken hold.

As you grapple with your newly elongated appendage, your tongue seems to come alive, writhing and twisting in the frosty air. The sensation is both captivating and disconcerting as the cold air causes the extended muscle to tingle in a way you've never experienced before. The heaviness of your tongue feels strangely sensual as it brushes against your lips and teeth, the sensation amplified by the frigid temperature.

Taking a few cautious steps, your new tongue coils and undulates as you try to adapt to this peculiar sensation. Icy gusts envelop your face, tenderly caressing your now exposed tongue, and sending shivers down your spine. The blend of the biting cold and the warm, damp sensation of your saliva on your extended tongue evokes a primal, almost erotic response within you.

After the initial shock subsides, you become intrigued by the potential of this Curse. Your mind races with the tantalizing possibilities your new appendage could offer.

<<include "Inhumanity Warning">>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Tipping the Scales [layer4]
<<set _curse = new TippingTheScales()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

You're hiking through the snowy landscape of the fourth layer, then, abruptly, your surroundings become a blur. The bitter cold intensifies, and a wave of energy surges through you, threatening to pull you apart and knit you back together. You instinctively clamp your eyes shut, bracing against the pain, the unease, the fear. The icy winds whistling past your ears seem to fade into the background.

Suddenly, your skin erupts in a peculiar sensation, akin to a thousand tiny needles pricking every inch of your exposed skin. It's as if the marrow in your bones is on fire. Your body jerks involuntarily as the pain radiates from the inside out.

You gasp for breath, your hands instinctively clawing at your clothing, seeking the source of the discomfort. But when you glance down, your sight falls upon something unexpected.

Your skin is no longer skin. Instead, it's blanketed by rigid scales. They gleam ominously in the pale light filtering through the fog. The pattern is wild, beautifully chaotic, radiating from your core and stretching outward across your limbs.

There's a moment of awe-struck silence, but it's interrupted by a fresh wave of change. You feel the tug of follicles, hairs emerging from the scales wherever you had them before the scales grew. It's a strange sensation, a mix of discomfort and tickling that sends you into a fit of shivers.

You take a few tentative steps, flexing your newly covered arms. Each movement sends a ripple through the scales, they shimmer and dance, seemingly attuned to your every action.

You ponder your newfound form, the feel of the scales against the bitter, frosty air, and the harsh snow under your feet. Your hairs twitch with each gust of the wind, your scales bristle with a heightened sensation that you've never experienced before.

Please enter your new scale color and press enter:

<<textbox "_curse.scaleColor" "green" "Layer4 Curses">>

<<include "Inhumanity Warning">>

:: Take on Reptail [layer4]
<<set _curse = new Reptail()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you trudge onward, the Curse begins to take effect. Your back starts to itch and tingle, the sensation growing increasingly intense until it's impossible to ignore. You reach back, attempting to soothe the itch, but your fingers find something unfamiliar. Your heart races, anxiety mounting as the sensation persists.

The skin on your lower back starts to stretch, pulled taut as something begins to emerge from beneath the surface. Pain and pressure swell as a thick, reptilian tail forces its way out of your body. Unable to contain yourself, you groan as the tail finally breaks free, now fully formed and extending a few feet behind you.

The tail is large, thick, and covered in scales that feel smooth and cool to the touch. Its spiky protrusions, reminiscent of miniature mountains, run the length of the tail, culminating in a menacing, spiked tip. The tail's weight poses a new challenge to your movements, causing you to struggle for balance as it swings and sways with each step.

As you continue to traverse the icy landscape, you discover that the Reptail Curse impacts your daily life in unexpected ways. Your once-agile movements are now hindered by the tail's weight and size, making it difficult to navigate the narrow paths and crevices of the Abyss. The tail's spiky protrusions snag on clothing, tearing the fabric and leaving you increasingly vulnerable to the frigid air. <<if $mc.hasCurse("Tipping the Scales")>>You also notice that the cold affects your tail more than the rest of your body, the reptilian scales offering little insulation against the biting chill.<</if>>

Though the Reptail Curse may seem like a burden, you find that it has its advantages. The tail can serve as a weapon, its spiky protrusions effective for repelling aggressive creatures that inhabit the Abyss, though perhaps not anything that would pose a serious threat to you. The tail also acts as a counterbalance once you're used to it, aiding you in maintaining your footing on the treacherous, icy terrain.

Despite these benefits, you can't shake the feeling of alienation brought on by the Curse. It almost feels like you aren't even human anymore.

<<include "Inhumanity Warning">>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Take on Cold Blooded [layer4]
<<set _curse = new ColdBlooded()>>\
<<set $mc.addCurse(_curse)>><<set $corruption += _curse.corr>>\
[img[setup.ImagePath + _curse.pic]]

As you venture further, the cold intensifies, penetrating even the thickest layers of your protective clothing. You rub your arms in a futile attempt to generate warmth, but it does nothing to dispel the icy tendrils that seem to have burrowed into your very core.

Suddenly, you feel an inexplicable force wash over you - a sensation akin to a thousand icy needles piercing your skin. You stumble to your knees, gasping for breath as aa wave of miasma envelops you. In that moment, you realize that you have been Cursed.

As the Curse takes hold, you feel your body's physiology shift dramatically. The once comforting warmth of your own body heat begins to dwindle, leaving you shivering uncontrollably. Your skin grows cold to the touch, and a chilling realization dawns on you: you've become cold-blooded.

Desperation begins to set in as you ponder the implications of this Curse. How will you survive the relentless cold of this layer now that your body can no longer generate its own warmth? You'll need to rely on external sources of heat to keep from freezing. The thought of cuddling up to another adventurer or using a portable heat source to stave off the cold provides a small measure of comfort, but the increased travel times and frequent stops to build campfires weigh heavily on your mind.

With each step you take, the frigid air seems to mock you, reminding you of the transformation you've endured.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Curses">Accept more Curses from the fourth layer</button>
    </div>
    <<if $escBalDepl===0>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
        </div>
    <<else>>
        <div class="menu-item">
            <button class="dark-btn obsidian" data-passage="Escape Balloon L4">Return to your balloon</button>
        </div>
    <</if>>
<</nobr>>


:: Layer4 Flasks [layer4]
<<nobr>>
<<for $i = 0; $i < 999; $i++>>
	<<if $items[2].count > 0>>
		<<set $items[3].count += 1>>
		<<set $items[2].count -= 1>>
		<<if $abyssKnow===1>>
			<<set $flaskMatrix[0]+=1>>
		<<else>>
			<<set $flaskMatrix[3]+=1>>
		<</if>>
	<<else>>
		<<break>>
	<</if>>
<</for>>
<</nobr>>

[img[setup.ImagePath+'Foraging/algalmeltwater.png']]

<<if $abyssKnow === 0>>
You ignite your campfire and melt some of the snow from the ground around you, slowly turning parts of the frozen wasteland around you into life-sustaining water. However, the moment you taste the water, you notice a strange taste, the hint of miasma, and feel a throbbing in your groin. You feel like this water is likely to have some effect on you down there.
<<else>>
Using your knowledge of the Abyss, you specifically look to make sure you can get some good water directly from the bluish-green snow that is found occasionally around the layer. The water has a slight green tint and a lightly minty flavor, but it seems pure and safe to you, allowing you to continue your journey with a larger store of water than before.
<</if>>
<button class="dark-btn obsidian" data-passage="Layer4 Forage">Return to exploring your food and water options on this layer</button>


:: Layer4 Steady1a [layer4]
<<PassTimeWithEvents>>\
<<if !setup.passingTime()>>\
<<= '<img src="' + setup.ImagePath + 'Wonders/steadyshrine1.png" class="half-size">' >>

As you draw nearer to the shrine, the structure's true nature reveals itself: an ancient, well-preserved shrine. Awe and relief wash over you as you take in the majesty of the Steady Shrine. The wood gleams with a warm, inviting luster, its finely carved details whispering tales of hope and perseverance.

You step forward, the hallowed ground seeming to cushion your every footfall. The air around the shrine seems charged with an energy that seems to defy the oppressive cold of the Abyss. The shrine's power beckons you closer, promising respite and a chance to share your burdens.

With a trembling hand, you reach out to touch the shrine, feeling its arcane energies pulse beneath your fingertips. The air around you shimmers as the shrine works its mysterious magic. In the silence that follows, you realize that you must now make a choice: share your Curse with a companion and lessen the burden on yourself or continue to bear it alone.

As you weigh your options, you cannot help but wonder what this decision will mean for your journey through the Abyss. Will your companions stand with you, knowing that they will share your Curses? Or will this choice drive a wedge between you and those who would otherwise stand by your side?

Which Curse would you like to transfer to your willing companion? It can't be too bad if they agreed to take it on.

<<nobr>>
<<if $dubloons < ($skewedUsed * 5)>>
	You do not have enough dubloons for an offering.
<<else>>
	<<for _companion range $hiredCompanions>>
		<<for _index, _curse range $mc.curses>>
			<<set _flag = false>>
			<<set _tempName = _companion.name>>
			<<set _companionId = _companion.id>>

			<<switch _companionId>>
				<<case setup.companionIds.twin>>
					<<if _index < 1>>Your twin already shares all of your Curses.<br><</if>>
				<<case setup.companionIds.golem>>
					<<if _index < 1>>You can't copy Curses to your Golem.<br><</if>>
				<<default>>
					<<if _index < 1>><br> _companion.name doesn't mind taking:<br><</if>>
					<<set _flag = setup.willingCurses(_companion).includes(_curse.name)>>
					<<if _flag>>
						/* Check whether companion already has this Curse (e.g. from this shrine). */
						<<set _flag = !_companion.hasCurse(_curse.name)>>
					<</if>>
			<</switch>>

			<<if _flag>>
				<<if _companion === $companionBandit>><<set _tempName = "Bandit">><</if>>
				<<capture _companion _curse _tempName>>
					&nbsp; _curse.name
					<button class="dark-btn obsidian" data-passage="Layer4 Steady1a" data-setter="_companion.addCurse(_curse.copy()), $corruption += Math.round(_curse.corr / 2), $dubloons -= ($skewedUsed * 5), $skewedUsed += 1">Choose</button>
					/* The CYOA states that the cost counter is shared between shrines. */<br>
				<</capture>>
			<</if>>
		<</for>>
	<</for>>
<</if>>
<</nobr>>

<button class="dark-btn obsidian" data-passage="Layer4 Steady 2a">On second thought, maybe a more forceful approach is warranted</button>

<button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
<</if>>


:: Layer4 Steady 2a [layer4]
<<PassTimeWithEvents>>\
<<if !setup.passingTime()>>\
<<= '<img src="' + setup.ImagePath + 'Wonders/steadyshrine1.png" class="half-size">' >>

As you draw nearer to the shrine, the structure's true nature reveals itself: an ancient, well-preserved shrine. Awe and relief wash over you as you take in the majesty of the Steady Shrine. The wood gleams with a warm, inviting luster, its finely carved details whispering tales of hope and perseverance.

You step forward, the hallowed ground seeming to cushion your every footfall. The air around the shrine seems charged with an energy that seems to defy the oppressive cold of the Abyss. The shrine's power beckons you closer, promising respite and a chance to share your burdens.

With a trembling hand, you reach out to touch the shrine, feeling its arcane energies pulse beneath your fingertips. The air around you shimmers as the shrine works its mysterious magic. In the silence that follows, you realize that you must now make a choice: share your Curse with a companion and lessen the burden on yourself or continue to bear it alone.

As you weigh your options, you consider the potential benefits of distributing your burden. Your eyes drift to the companion you have restrained nearby, wearing fearful expression on their faces. You could take the path of self-preservation, forcing the Curse upon them against their will. After all, in the depths of the Abyss, sacrifices must be made for one's own survival.

The knot of doubt that forms in the pit of your stomach is easily ignored as you focus on the greater goal of conquering the Abyss. The line between survival and cruelty may blur, but you have long since come to terms with the idea that not everyone can emerge unscathed from this treacherous journey.

With the Steady Shrine's power at your fingertips, you must now decide: do you impose your Curse upon your unwilling companion, prioritizing your own well-being at their expense, or do you release them and face the Abyss on your own terms? The decision seems straightforward to you, a necessary evil to achieve success.

Which Curse would you like to forcibly copy onto your unwilling companion?

<<nobr>>
<<if $dubloons < ($skewedUsed * 5)>>
	You do not have enough dubloons for an offering.
<<else>>
	<<for _i, _curse range $mc.curses>>
		<<if _curse.name !== 'Double Trouble' && _curse.name !== 'Conjoined' &&
			!$hiredCompanions.every(companion => companion === $companionGolem || companion.hasCurse(_curse.name))
		>>
			<<capture _i>>
				<button class="dark-btn obsidian" data-passage="Layer4 Steady2b" data-setter="$temp = _i">_curse.name</button><br>
			<</capture>>
		<</if>>
	<</for>>
<</if>>
<</nobr>>

<button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
<</if>>


:: Diver shrine [layer4]
Here you can compile constellations of Curses to inflict on other divers visiting this shrine, or let yourself be cursed by another diver's constellation for extra corruption.

<<nobr>>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Diver shrine builtins">View constellations left by previous divers</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Diver shrine user">View constellations you created</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Diver shrine take random">Take on a random constellation for 1.5x corruption</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Diver shrine make new">Create a new constellation of curses for future divers</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Diver shrine import">Import/export constellations</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Steady Shrine Site">Go back to the Steady Shrine</button>
</div>
<</nobr>>

:: Diver shrine builtins [layer4]
These constellations of curses have been left by previous divers.
You may choose one of them and be cursed with it for the usual corruption, or go back and choose to be inflicted with a random constellation for additional corruption.

<<nobr>>
	<<for _constellation range setup.getCurseSets()>>
		<<capture _constellation>>
			<button class="dark-btn obsidian" data-passage="Diver shrine inspect constellation" data-setter="$diverShrineSelectedCurse = _constellation.name">_constellation.name</button>
			<br>
		<</capture>>
	<</for>>
<</nobr>>

<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>

:: Diver shrine user [layer4]
These are the constellations of curses you (or previous divers in your slice of the multiverse) created.
You may choose one of them and be cursed with it for the usual corruption, or go back and choose to be inflicted with a random constellation for additional corruption.

<<nobr>>
	<<for _constellation range setup.getUserCurseSets()>>
		<<capture _constellation>>
			<button class="dark-btn obsidian" data-passage="Diver shrine inspect user constellation" data-setter="$diverShrineSelectedCurse = _constellation.name">_constellation.name</button>
			<br>
		<</capture>>
	<</for>>
<</nobr>>

<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>

:: Diver shrine inspect constellation [layer4 nobr]
<<set _constellation = setup.getCurseSets().find(c => c.name === $diverShrineSelectedCurse)>>
This constellation includes the following curses:<br><br>
<<for _curse range _constellation.curses>>
	/* We could also make this a link which inserts the description when clicked, but I don't want to spoil curses
	 * they haven't seen yet. */
	<<print _curse.name>><br>
<</for>>
<br>
If you own the notebook or smartphone you can look up the description of curses you know about in the layer notes.<br>
If you don't remember them, or haven't been to their layer... You're in for a surprise :)
<br><br>
Description:<br>
<<print _constellation.description>>
<br><br>
<button class="dark-btn obsidian" data-passage="Diver shrine take constellation">Take on this constellation</button><br>
<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>

:: Diver shrine inspect user constellation [layer4 nobr]
<<set _constellation = setup.getUserCurseSets().find(c => c.name === $diverShrineSelectedCurse)>>
This constellation includes the following curses:<br><br>
<<for _curse range _constellation.curses>>
	/* We could also make this a link which inserts the description when clicked, but I don't want to spoil curses
	 * they haven't seen yet. */
	<<print _curse.name>><br>
<</for>>
<br>
If you own the notebook or smartphone you can look up the description of curses you know about in the layer notes.
If you don't remember them, or haven't been to their layer... You're in for a surprise :)
<br><br>
Description:<br>
<<print _constellation.description>>
<br><br>
<button class="dark-btn obsidian" data-passage="Diver shrine take user constellation">Take on this constellation</button><br>
<button class="dark-btn obsidian" data-passage="Diver shrine" data-setter="setup.removeUserCurseSet($diverShrineSelectedCurse)">Remove this constellation</button><br>
<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>
<br><br>
If you want to share this constellation with others, use this code:
<pre><<print JSON.stringify(_constellation)>></pre>
You can triple-click inside the code box to select it all.

:: Diver shrine take random [layer4 nobr]
<<set _systemConstellations = setup.getCurseSets()>>
<<set _userConstellations = setup.getUserCurseSets()>>
<<set _constellations = _systemConstellations.length + _userConstellations.length>>
<<set _selected = Math.floor(Math.random() * _constellations)>>
<<if _selected < _systemConstellations.length>>
	<<set $diverShrineSelectedCurse = _systemConstellations[_selected].name>>
	<<set _constellation = _systemConstellations[_selected]>>
<<else>>
	<<set $diverShrineSelectedCurse = _userConstellations[_selected - _systemConstellations.length].name>>
	<<set _constellation = _userConstellations[_selected - _systemConstellations.length]>>
<</if>>

<<if _constellation.canBeTakenBy($mc)>>
	You've been inflicted with the $diverShrineSelectedCurse constellation!<br>
	<<set _diverShrineMultiply = true>>
	<<include "Diver shrine apply constellation">>
<<elseif _systemConstellations.concat(_userConstellations).every(c => !c.canBeTakenBy($mc))>>
	There are no constellations you are able to take. They all have unfulfilled requirements, such as a curse
	which is incompatible with your current curses, or you already have all the curses in the constellation.
<<else>>
	<<include "Diver shrine take random">>
<</if>>

:: Diver shrine take constellation [layer4 nobr]
<<set _constellation = setup.getCurseSets().find(c => c.name === $diverShrineSelectedCurse)>>
<<set _incompatible = false>>
<<for _curse range _constellation.curses>>
	<<if !$mc.isCompatible(_curse)>>
		<<set _incompatible = _curse.name>>
		<<break>>
	<</if>>
<</for>>
<<set _unfulfilledRequirements = _constellation.requirements.filter(r => !r.isSatisfiedBy($mc))>>
<<if _incompatible !== false>>
	This constellation includes the _incompatible curse which cannot be taken with your existing curses.<br>
	<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>
<<elseif _unfulfilledRequirements.length > 0>>
	The following requirements for taking this constellation are not met:
	<ul>
	<<for _req range _unfulfilledRequirements>>
		<li><<print _req.errorMessage()>></li>
	<</for>>
	</ul>
<<else>>
	<<include "Diver shrine apply constellation">>
<</if>>

:: Diver shrine take user constellation [layer4 nobr]
<<set _constellation = setup.getUserCurseSets().find(c => c.name === $diverShrineSelectedCurse)>>
<<set _incompatible = false>>
<<for _curse range _constellation.curses>>
	<<if !$mc.isCompatible(_curse)>>
		<<set _incompatible = _curse.name>>
		<<break>>
	<</if>>
<</for>>
<<set _unfulfilledRequirements = _constellation.requirements.filter(r => !r.isSatisfiedBy($mc))>>
<<if _incompatible !== false>>
	This constellation includes the _incompatible curse which cannot be taken with your existing curses.<br>
	<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>
<<elseif _unfulfilledRequirements.length > 0>>
	The following requirements for taking this constellation are not met:
	<ul>
	<<for _req range _unfulfilledRequirements>>
		<li><<print _req.errorMessage()>></li>
	<</for>>
	</ul>
<<else>>
	<<include "Diver shrine apply constellation">>
<</if>>

:: Diver shrine apply constellation [layer4 nobr]
You got the following new curses:<br>
<<for _curse range _constellation.curses>>
	<<set _constellationCount = _constellation.curses.filter(c => c instanceof _curse.constructor).length>>
	<<set _userCount = $mc.events.filter(c => c instanceof _curse.constructor).length>>
	<<if _userCount < _constellationCount && $mc.isCompatible(_curse)>>
		<h2>
			<<if _curse instanceof BelowTheVeil>>
				B̸̳̀e̷̞̅l̷̠̽o̸̝͝w̶̻̄ ̵̡͊t̶̖͠h̵͙̔ë̵͎́ ̸̭́V̸̖͘e̸̓͜ḭ̴͂l̷͕̅
			<<else>>
				<<print _curse.name>>
			<</if>>
		</h2>
		<<if _curse instanceof SemenDemon && $mc.hasCurse(SemenDemon)>>
			<<set _curse.fluidType = $mc.getCurse(SemenDemon).fluidType>>
		<</if>>
		<<if _curse.name.startsWith("Libido Reinforcement ") || _curse.name.startsWith("Gender Reversal ")>>
			<<LeveledCurseDescription `_curse.name`>>
		<<else>>
			<<print _curse.description>>
		<</if>>
		<<if _diverShrineMultiply>>
			<<set _curse.corruption = Math.floor(_curse.constructor.corruption * 1.5)>>
		<<else>>
			<<set _curse.corruption = _curse.constructor.corruption>>
		<</if>>
		<<set $mc.addCurse(_curse)>>
		<<set $corruption += _curse.corruption>>
	<</if>>
<</for>>
<br><br>
<button class="dark-btn obsidian" data-passage="Diver shrine">Continue</button>

:: Diver shrine make new [layer4 nobr]
Choose a name for your new constellation. Using an existing name will overwrite that constellation.<br>
<<set _name = "myConstellation">>
<<textbox '_name' 'myConstellation'>><br>
Write a description for your new constellation. Be as brief or as expansive as you want.
<<textarea '_description' ''>>
<br><br>
Choose a subset of your current curses to form a new constellation:<br>
<<set _curses = []>>
<<for _curse range $mc.curses>>
	<<capture _curse, _toggle>>
		<<set _toggle = toggle((curse => b => b === true ? _curses.pushUnique(curse) : _curses.delete(curse))(_curse))>>
		<label style="display:flex;justify-content:space-between;align-items:center;max-width:30em;margin:auto;"><<print _curse.name>> <<printHTML _toggle>></label>
	<</capture>>
<</for>>
<div id="diver-shrine-confirm-diag" style="display:none">
	Constellation Saved. If you want to share this constellation with others, use this code:
	<pre id="diver-shrine-export-box"></pre>
	You can triple-click inside the code box to select it all.<br>
	Note that these constellations, like saves, are stored in local storage — a browser feature to persist data.<br>
	This means that if you use a different browser (or in some browsers a different profile) you won't see them and
	if you're using a private window, they'll be deleted when you close the tab (or window, depends on the browser).<br>
	If you delete this website's data ("Clear cookies and site data" or similar buttons), they'll disappear too.<br>
	In any of these cases, save the above code somewhere and import it again to restore the constellation.
</div><br>
<<LinkButton "Save" "Save" "dark-btn obsidian">>
	<<set _constellation = new Constellation(_name, _curses, _description)>>
	<<set setup.addUserCurseSet(_constellation)>>
	<<set $('#diver-shrine-export-box').text(JSON.stringify(_constellation))>>
	<<set $('#diver-shrine-confirm-diag').css({display: 'initial'})>>
<</LinkButton>><br>
<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>

:: Diver shrine import [layer4]
WARNING: Constellation codes can be abused to run arbitrary code. A malicious person could share a fake \
constellation code that instead of adding a constellation performs other actions.
It could change the state of your game, change the game itself, show deceiving messages or mine cryptocurrencies \
in your browser.

It could <b>not</b> access your hard drive or any personal information that you haven't typed into the game and \
it will become inactive when you close this tab (although it could store itself and reactivate next time you open the game).
Entering an untrusted code on this page is about as dangerous as visiting any other untrusted website, as long as you \
keep in mind that after you do it, you should consider the entire game untrusted, even if previously you didn't.

We recommend not to use any constellation codes from sources you don't trust.


Use this code to share all your constellations:\
<pre>\
<<print JSON.stringify(setup.getUserCurseSets())>>
</pre>\
Paste such a code here to import all of its constellations. Note that if you already have constellations with the same name, they will be overwritten.
<input type="text" id="diver-shrine-bulk-import-field" />

<<LinkButton "Import constellations" "none" "dark-btn obsidian">>
	<<set _constellations = JSON.tryParse($('#diver-shrine-bulk-import-field')[0].value)>>
	<<if _constellations === false || !(Array.isArray(_constellations) && _constellations.every(c => c instanceof Constellation))>>
		<<set alert('The code you provided is not a valid set of constellations. It could be a single constellation, in which case use the form below to import it.')>>
	<<else>>
		<<set for (let constellation of _constellations) {
			if (!setup.addUserCurseSet(constellation)) {
				alert(`Importing constellations failed at constellation ${constellation}. This happened because the place where constellations are stored has limited size, and we ran out of space. This is configurable on most browsers (look up "increase local storage size" for your browser). Note that saves (including the automatic one that lets your reload the page without losing progress) and Curse constellations are stored in the same place and so compete for space. A large number of constellations will reduce the space available for saves and vice-versa. This means you might be able to make more space by deleting some saves or constellations. It also means that if importing this constellation failed, saving (including the mentioned automatic save) might fail soon too. We recommend ensuring that there is sufficient space immediately.`);
				break;
			}
		}>>
		<<set $('#diver-shrine-bulk-import-field')[0].value = ''>>
	<</if>>
<</LinkButton>>


Import a single constellation's code here:
<input type="text" id="diver-shrine-import-single-field" />
Write a name here if you want to replace the constellation's name (e.g. to avoid a collision with an existing constellation):
<input type="text" id="diver-shrine-import-single-name" />

<<LinkButton "Import constellation" "none" "dark-btn obsidian">>
	<<set _name = $('#diver-shrine-import-single-name')[0].value>>
	<<set _constellation = JSON.tryParse($('#diver-shrine-import-single-field')[0].value)>>
	<<if !_constellation instanceof Constellation>>
		<<set alert('The code you provided is not a valid constellation. It could be a set of constellations instead, in which case use the form above to import it')>>
	<<elseif _name !== ''>>
		<<set _constellation.name = _name>>
	<<else>>
		<<if !setup.addUserCurseSet(_constellation)>>
        	<<set alert(`Importing constellations failed. This happened because the place where constellations are stored has limited size, and we ran out of space. This is configurable on most browsers (look up "increase local storage size" for your browser). Note that saves (including the automatic one that lets your reload the page without losing progress) and Curse constellations are stored in the same place and so compete for space. A large number of constellations will reduce the space available for saves and vice-versa. This means you might be able to make more space by deleting some saves or constellations. It also means that if importing this constellation failed, saving (including the mentioned automatic save) might fail soon too. We recommend ensuring that there is sufficient space immediately.`);>>
        <</if>>
        <<set $('#diver-shrine-import-single-field')[0].value = ''>>
        <<set $('#diver-shrine-import-single-name')[0].value = ''>>
	<</if>>
<</LinkButton>>

<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>


:: Purity Tree Site [layer4]
<<PassTimeWithEvents>>\
<<if !setup.passingTime()>>\
[img[setup.ImagePath+'Wonders/puritytree.png']]
<<if !$purityUsed>>
As you trudge through the biting cold and the relentless, swirling winds, the endless expanse of snow and ice begins to blur together. The miasmal light casts eerie shadows across the landscape, and the numbing chill penetrates even the thickest of clothing. Just when hope seems all but lost, you spot a faint glow in the distance, cutting through the thick fog like a beacon.

Curiosity piqued, you cautiously approach the source of the light. Your breath catches in your throat as you lay eyes upon the mythical Purity Tree. The radiant white wood of the tree emanates a soft, yet mesmerizing iridescence that shimmers with the colors of the rainbow. The delicate, crystalline leaves chime in the gentle breeze, creating a soothing melody that echoes through the otherwise silent, frozen expanse.

As you draw closer, you notice that the air around the Purity Tree feels lighter, fresher, as if it's cleansing the miasma that clings to your lungs. The bitter cold momentarily retreats, as if in reverence to the tree's purifying aura. You can't help but feel a sense of awe at the sight of the rare and beautiful Purity Tree, standing defiantly against the harshness of the Abyss.

You consider your options carefully, knowing that the wood of the Purity Tree holds untold potential. What would you like to do with the Purity Tree?
<<if setup.haveCuttingTool>>
You can chop down the dead purity tree and use the pieces to make crude protective gear for a total of +60 corruption immediately.
<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$purityUsed = true, $corruption += 60">Chop down the tree and make crude protective gear</button>

You could also chop down the tree and save the wood pieces. This will yield four Purity Tree Plank Relics, which you can bring back to the surface and either sell for 35 dubloons each or use in the Relic Workshop to gain +25 corruption per Plank (100 total).
<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$purityUsed = true, $ownedRelics.push($purityPlank, $purityPlank, $purityPlank, $purityPlank)">Chop down the tree and save the pieces to use them on the surface</button>
<<else>>
You don't have the right tools to chop down the dead purity tree.
<</if>>
You can burn down the dead purity tree and bathe in the raw cleansing smoke to gain +20 corruption a single time.
<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$purityUsed = true, $corruption += 20">Burn down the tree and bathe in its smoke</button>

<<nobr>><<if !$hasPuritySeed && $emilyVisit>>
<button class="dark-btn obsidian" data-passage="Layer4 Purity Seed">Search for the Purity Seed amongst the tree's remains</button><br><br>
<</if>><</nobr>>\
<button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
<<else>>
Feeling the familiar sting of the icy wind on your skin, you find yourself drawn to the place where the Purity Tree once stood. The moonlight casts a soft glow over the snow-covered landscape, and the once vibrant glow that beckoned you is nowhere to be found.

As you step closer, the image of the fallen Purity Tree is a reminder of your past actions. The once bright, iridescent white wood, now reduced to a mere stump, seems to pale against the monotonous background of the frozen expanse. The radiant light that shimmers with the colors of the rainbow is only a memory, and the wind that once stirred crystalline leaves now only produces a hollow, echoing dirge.

Where once the air was fresh and clean, the miasma has returned, stifling and heavy. The warmth and sense of sanctuary that the tree's purifying aura provided is gone, replaced by the relentless, gnawing cold that seeks to pierce through every layer of your clothing.

You draw nearer, and a twinge of regret seizes you. The Purity Tree, once a beacon of hope amidst the Abyss, is gone now. Its wood, which held untold potential, has been consumed, leaving behind only remnants of what once was.

You stand there, the bitter cold nipping at your face, confronted by the harsh reality of your actions. The Purity Tree has given all it had, and there is nothing left for you here. You are left with only the memory of the tree's light in the desolate expanse.

Time to move on.

<<nobr>><<if !$hasPuritySeed && $emilyVisit>>
<button class="dark-btn obsidian" data-passage="Layer4 Purity Seed">Search for the Purity Seed amongst the tree's remains</button><br><br>
<</if>><</nobr>>\
<button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring layer 4</button>
<</if>>
<</if>>


:: Layer4 Steady2b [layer4]
<<= '<img src="' + setup.ImagePath + 'Wonders/steadyshrine1.png" class="half-size">' >>

Which companion would you like to forcibly copy the Curse of $mc.curses[$temp].name onto?

The magic of the shrine wisps through the air menacingly as your victim struggles helplessly.

<<nobr>>
<<set _curse = $mc.curses[$temp]>>
<<for _i, _companion range $hiredCompanions>>
	<<set _flag = false>>
	<<set _tempName = _companion.name>>
	<<set _companionId = _companion.id>>

	<<switch _companionId>>
		<<case setup.companionIds.twin>>
			Your twin already shares all of your Curses.<br>
		<<case setup.companionIds.golem>>
			You can't copy Curses to your Golem.<br>
		<<default>>
			/* Check whether companion already has this Curse (e.g. from this shrine). */
			<<set _flag = !_companion.hasCurse(_curse.name)>>
			<<if !_flag>>_companion.name already has this Curse!<br><</if>>
	<</switch>>

	<<if _flag>>
		<<if _companion === $companionBandit>><<set _tempName = "Bandit">><</if>>
		<<capture _companion _i _tempName>>
			<<set _choiceText = "Copy to " + _tempName>>
			<button class="dark-btn obsidian" data-passage="Layer4 Steady Apply" data-setter="_companion.addCurse(_curse.copy()), $corruption += Math.round(_curse.corr / 2), $dubloons -= ($skewedUsed * 5), $skewedUsed += 1, $temp2 = _i">_choiceText</button><br>
		<</capture>>
	<</if>>
<</for>>
<</nobr>>


:: Layer4 Steady Apply [layer4]
<<= '<img src="' + setup.ImagePath + 'Wonders/steadyshrine1.png" class="half-size">' >>

<<nobr>>
<<set $skewedForced += 1>>
<<set _companionId = $hiredCompanions[$temp2].id>>
<<set _affectionPenalty = 6 - $hsswear>>
<<include "Companion Mistreatment Reaction">>
<</nobr>>
<<nobr>>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Steady 2a">Stand in front of the shrine to force another Curse</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Steady1a">On second thought, maybe a more diplomatic approach would be advisable</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue with your journey</button>
</div>
<</nobr>>

:: Pick up the Ghost-righter Writing Down [layer4]
<<CollectRelic $relic34>>\
<<if !setup.passingTime()>>

As your eyes adjust to the swirling, icy fog, you notice something peculiar - an odd, crystalline formation that stands out amid the snow and ice. It's a colossal glacier, perfectly clear and shining with a strange light through its blue glacial ice. What catches your attention are the countless, intricate carvings etched into its surface. Scenes of forgotten tales, narratives of ages past, and cryptic symbols intertwine, their elaborate designs shimmering and dancing under the dim, diffused light.

Approaching the glacier, you notice the design of an open book etched into the ice. You place your gloved hand onto it, the ice prickling your skin despite the protection. The etched book begins to glow, its outline brightening to a blinding white light. As quickly as it came, the light fades, revealing an alcove in the ice. Nestled within it lies a single, delicate feather.

The feather is luminous in the dimly lit layer, its intricate barbs glowing gently like moonlight against the backdrop of frost. Picking it up, the feather feels almost weightless, but with an indescribable, pulsating warmth. The pen tip is sharp and surprisingly resilient, despite the softness of the feather. This is the Ghost-righter Writing Down - a Relic imbued with the power to turn even the clumsiest prose into elegant narratives.

You take out a piece of parchment from your satchel, scribbling a quick note using the feather. The ink from the feather flows onto the page like quicksilver, the cold seemingly having no effect on its fluidity. Satisfied, you tuck the parchment away for later. You can't help but look forward to the transformation that awaits the humble note.

Retrieving the Relic was just the beginning of the adventure. Holding the feather aloft, you can almost hear the echo of the countless stories, poems, and scripts that have been penned with it. The Relic whispers promises of perfect prose, tales untold, and a newfound sense of connection with the universal language of storytelling.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Gilded Prison [layer4]
<<CollectRelic $relic35>>\
<<if !setup.passingTime()>>

The biting winds occasionally loosen icy chunks from the overhead canopy, which then tumble to the ground as snow or hail. Amidst this icy wilderness, you notice sparse, hardy shrubs huddling for warmth.

A sound interrupts your contemplation, a hollow, metallic echo that originates from the depths of a nearby glacial crevasse. Intrigued, you move towards the sound. The crevasse reveals a winding path that burrows deep into the glacier's heart. You decide to venture in, following the strange sound that seems to grow louder as you go deeper.

In the crevasse's gloom, you find an unexpected sight: an enormous, ornate golden cage, the Gilded Prison. The cage's lustrous surface is out of place in this icy world. Despite its location, it isn't touched by frost or ice. Intricate patterns carved onto its surface tell a story, perhaps of its creation, or of a forgotten civilization. As the sounds you heard earlier echo around you, you realize they emanate from the cage itself. It's as if the Gilded Prison is singing a lonely song in this frozen cavern.

With careful, measured movements, you approach the Relic. The air around it shimmers slightly, the only indication of its powerful effects. Taking a deep breath, you prepare to retrieve the Relic. You reach out and touch the icy-cold bars of the Gilded Prison. There's a quiet hum of power beneath your fingertips, a barely audible promise of preservation.

You retrieve the cage, taking care not to jostle it too much. It's surprisingly light, despite its size. The moment the Gilded Prison is moved, the shimmering air around it disappears, pausing its time-stopping properties. As you carefully pack it away, you spare a final glance at the icy cavern, once home to this precious Relic, as you continue your expedition.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Omoikane Circuit [layer4]
<<CollectRelic $relic36>>\
<<if !setup.passingTime()>>

Up ahead, you see a sudden break in the icy monotony of the fourth layer. A massive glacier, towering into the foggy abyss above and buried deep into the frost-laden ground below. In its frozen heart, the faint outline of a structure, half buried and time-forgotten. A technological hub, perhaps once bristling with activity, now silenced by the inexorable march of time and ice. You approach, your curiosity piqued.

Despite the encroaching ice, the building's exterior still showcases glimpses of its former grandeur. Abstract, futuristic patterns etched into metal, barely discernible beneath the heavy frost. You make your way through a broken entranceway, stepping over the shards of a once-secure door.

Inside, the building is a maze of frozen-over technology, blinking lights dimly visible beneath a layer of frost. Frost-cracked monitors and desks laden with ancient devices, frozen mid-action. The freezing temperatures make everything brittle, but amidst this wreckage, a faint glow draws your attention.

Tucked away in a small, ice-encrusted room is a console, its screen emitting a soft, inviting light. On its surface, a slot that perfectly matches the size of a SIM card beckons. You move closer, intrigued by the console's unexpected liveliness amidst this icy tomb.

As you approach, a holographic display flickers to life, surprising you with its brightness and clarity. It depicts a swirling galaxy of information - circuits and codes coalescing into something... more. At the heart of this galactic display, there is a small, radiant object - a chip, glowing with a light that seems to cut through the biting cold. The Omoikane Circuit.

Your fingers carefully coax the chip from its frozen hold, warmth emanating from it and spreading through your numb fingers. You examine it closely, its surface gleaming with intricate circuitry, a silent hum coming from it, as if yearning for a host.

You stand there, in the heart of this icy ruin, holding the ultimate symbol of progress and technology. A connection to a time before the frost, a whisper of humanity's relentless will to thrive. The Omoikane Circuit is now yours.

<b>You can install this in a smartphone if you return to the Relic Workshop on the surface.</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Afar Wanderer [layer4]
<<CollectRelic $relic37>>\
<<if !setup.passingTime()>>

Ahead, a peculiar sight breaks the endless white: an unusual, frosted structure that resembles a spiral staircase, formed by twisted, tortured ice formations. You approach cautiously, noticing a faint indigo glow emanating from the heart of the structure, buried deep within the coiled ice.

You ascend the frozen stairs, the cold growing more biting with each step. The closer you get, the stronger the glow becomes, illuminating the icy spiral with surreal radiance.

You arrive at the top, greeted by the sight of the Afar Wanderer, cradled in a bed of shimmering ice crystals. It's an otherworldly vision - a wand of flowing design, imbued with an indigo aura that pulses gently in rhythm with the windy breath of the Abyss. Its shape echoes the surrounding ice formations, as though it was birthed by the very heart of this icy realm.

You stretch out your gloved hand to retrieve it, but the moment your fingers brush the surface of the wand, the ice bed shatters abruptly. But the Wand floats in mid-air, held aloft by some unseen force. This gives you an opportunity to grab it. For a moment it feels resistant, as if tied to the pedestal that it formerly resided upon, but then the connection is broken and it feels like a normal wand in your hand and its glow fades.

With the Afar Wanderer secured, you make your way back, leaving the silent, icy tower behind. 

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Kin Shifter [layer4]
<<CollectRelic $relic38>>\
<<if !setup.passingTime()>>

As you head deeper into the fourth layer, the landscape subtly morphs. The snow-blanketed expanse is punctuated by small glacial mountains. You notice a peculiar cluster of icicles suspended from a protruding ledge, refracting the dim ambient light, providing just enough illumination to pierce through the fog. It appears like a gateway, an entrance to somewhere yet unexplored.

Drawn by the allure of discovery, you approach the icy archway. The crunch of your footsteps in the snow resonates in the silence. Beyond the gateway, you find a cavern. The air within is eerily still, the cold less biting. Crystal formations cover the cavern walls, a maze of stalactites and stalagmites in a frozen tableau.

The heart of the maze houses an intriguing sight. An anomaly that refuses to be overlooked. Nestled in a depression in the icy floor is the Kin Shifter, a glob of putty-like slime. Its jelly-like substance oscillates in rhythm, a pulse of life amidst the frozen solitude. The face in the glob glimmers, decorated in a fashion that starkly contrasts the rest of its appearance.

Your heart hammers in your chest as you reach out. The air around the artifact seems to ripple with latent power. As your fingers make contact, you feel a pulse, akin to a dormant engine roaring to life. A portion of the Kin Shifter moves, reaching out, hungry for the touch of another Relic you possess. It is ready for the transformation, to emulate a perfect replica of a Relic you own, replicating all its characteristics, abilities, value, and weight.

Upon retrieving the Kin Shifter, it feels heavier, pulsating with potential.

<b>You can use this Relic to copy other Relics you have to get more uses out of them or just get a great value by copying other valuable Relics!</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Brave Vector [layer4]
<<CollectRelic $relic39>>\
<<if !setup.passingTime()>>

Your heart races as you approach the icy monolith, a hulking structure of metal and gears embedded in the snowy mountainside. The entrance, a yawning gateway with intricately interlocking cogwork, beckons you into its mechanical maw. As you draw closer, the relentless bitter cold seeping through your insulating gear seems to dissipate, replaced by an eerie warmth emanating from the mechanical fortress. You rub your frosted gloves together, relishing the momentary reprieve from the cold as you cross the threshold into the unknown.

The interior is a marvel of steampunk engineering. Vast cylinders of iron and brass turn endlessly, the rhythmic churning of gears and pistons filling the air with a deep, resonating hum. Shafts of cold light filter down from the ice overhead, casting an otherworldly glow on the maze of spinning machinery. The mechanical gears, despite their imposing size, move with a certain fluidity, an oddly harmonious balance between nature and machine.

As you navigate the labyrinth of cogwork, you notice an increasing intensity in the rhythm, the pulse quickening like the heartbeat of the mountain. Your eyes catch sight of a cylindrical metal pipe, remarkably ordinary amid the grandiose machinery. It lays horizontally, suspended in the air by a complex armature of gears and pulleys.

With a deep breath, you reach out to the pipe. It's cool to the touch, an oddity in this warm metal cave. Carefully, you disengage it from its mounting. The gears groan in protest, their rhythm faltering for a moment before finding a new equilibrium.

The Brave Vector is now in your possession. You marvel at its simple yet potent design. It's lighter than it looks, but when you drop a small piece of broken gear into one end, it shoots out the other end with a speed that makes your heart skip a beat. The very air seems to shudder in its wake.

Your mission accomplished, you carefully store the Relic in your pack. The mechanical fortress seems to sigh as you make your way to the entrance, the rhythm of the gears slowing, returning to their initial state. As you emerge back into the biting cold, the mountain behind you groans as it returns to slumber.

<b>While this Relic may not be very functional in its current form as a bent pipe, a trip to the Relic Workshop could transform it into a powerful and efficient weapon.</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Devil's Own [layer4]
<<CollectRelic $relic40>>\
<<if !setup.passingTime()>>

As you move through the frosty expanse of the fourth layer, the chill seeping through your heavy clothing is almost unbearable. Each breath you draw is laced with the biting cold, making your lungs ache. Despite the layers of gear you donned before your descent, the miasma-enhanced cold pierces through, making your teeth chatter in an unending cadence. Small patches of stubborn vegetation peep out from under the snow, brittle from the relentless cold.

You spot a structure in the distance. It's a small, dilapidated cabin, just a mere silhouette against the icy mist. The cabin's roof is layered with heavy snow, threatening to collapse under the weight, while its walls are scarred from the trials of weathering the deadly cold. Its wooden door creaks ominously as the miasma-produced winds blow. This desolate cabin doesn't promise warmth or refuge, but it catches your interest. Something about it feels significant, perhaps even supernatural.

Steeling yourself, you move towards it, pushing through knee-deep snow, feeling the biting sting of hail against your exposed face. Inside the cabin, an uncanny sight greets you - amidst the freezing cold, a lone hearth glows with a soft, warm light. The heat radiating from it is somehow soothing.

Above the hearth hangs an aged painting, it depicts a strikingly green four-leaf clover standing out against a barren winter landscape. As you glance at the painting, a small drawer below the hearth catches your eye. Its wood is dark and old, and it creaks as you pry it open. Inside, nestled upon a velvet cushion, is a small charm. It's shaped like a four-leaf clover, and it gleams in the hearth's light - the Devil's Own.

As you pick up the charm, you feel a sense of peace wash over you. You note a lack of spilled ashes from the hearth, the absence of an errant gust of wind sneaking in from the cabin's decrepit walls. The menacing cold appears to have lost some of its bite. The charm's magic is subtle yet potent, and you tuck it away in your pocket, feeling safer than you have in a while.

<b>If you have Cherry as a companion, this Relic will provide the useful boon of a single use reroll of her Chaotic Luck.</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Verve Cell [layer4]
<<CollectRelic $relic41>>\
<<if !setup.passingTime()>>

You trudge onward through the biting cold, every step crunching beneath your feet on the snow-laden ground. The fourth layer of the Abyss, an icy wasteland, is as beautiful as it is deadly. Small glacial mountains, crystalline in their sheen, rise like the backbones of ancient leviathans around you.

Ahead, you see an anomaly – a large, dome-like structure made entirely of ice, its surface glimmering with a multitude of colors refracted from the shards of ice above. The structure emanates a strangely welcoming aura, contrasting with the otherwise hostile environment.

You approach the ice dome, careful to remain alert for any sudden movements of the miasma, or the sudden falling of ice shards. The entrance of the dome is a narrow archway, just big enough for you to pass through. You step inside, and a warm gust of air surprises you. The interior is lined with glowing crystals, shedding a gentle, ambient light around. The warm air seems to emanate from these crystals, creating a pocket of refuge within the brutal cold of the layer.

In the center of the dome, mounted on an icy pedestal, rests the Verve Cell. It appears as an exquisite hammer, its form seems to be embedded with a few pieces of crystal that shimmer with latent energy. It looks remarkably light, and somehow you know that regardless of how hard you swing it, it will only ever deliver the lightest tap.

You extend a hand and cautiously pick up the Verve Cell. It hums in your grip, resonating with your touch. 

As you secure the Verve Cell into your satchel, you begin your journey once again.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Vessel Vivisector [layer4]
<<CollectRelic $relic42>>\
<<if !setup.passingTime()>>

Your instincts lead you towards a tall, glacier-topped mountain. Your eyes squint through the snowfall and you can see the mountain's icy apex, an ominous and daunting silhouette.

As you approach the glacial mountain, you can see something odd about the ice formation. It seems as if there's an unnatural separation in the ice, as if the glacier was split in two by some unseen force. A faint glow emanates from within, giving the icy divide a spectral quality. This resonates with the description of the Vessel Vivisector, its ability to create spectral duplicates, mirroring the spectral glow emanating from the glacial split.

You climb the mountain, maintaining your grip on the slippery ice. The cold is punishing, the wind howling like a feral beast, but you push on. Soon enough, you reach the divide. A shiver of anticipation courses through you as you reach into the crevice, your gloved hand brushing against something metallic.

Pulling it out, you find it's a small scalpel, delicate yet cold to the touch. The handle is etched with intricate designs that glow faintly, matching the spectral glow from the crevice. You can feel a sense of energy within it, the power of the Vivisector waiting to be unleashed.

As you hold the Vivisector, you test its power, making a slight cut on your hand. You watch as a ghostly afterimage separates from you, its translucent form mimicking your actions, your posture. It's a ghost, your ghost, performing the same act of discovery you just went through.

Looking around, you decide to use the Vivisector on one of the hardy plants, curious to see what would happen. After the cut, a ghostly replica of the plant appears, sitting sturdily against the harsh conditions, a phantom in the blizzard. It's a beautiful, haunting sight, yet the confirmation of the Relic's power sends a wave of relief through you.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Sated Artist [layer4]
<<CollectRelic $relic43>>\
<<if !setup.passingTime()>>

As the freezing winds rip through your protective gear, you lower your gaze to the small, sparse vegetation around you. Trudging through the bitter cold, you spot a peculiar set of tracks leading to one of the ice mounds. You decide to follow it.

The tracks lead you into a hidden crevice within the ice. You enter it cautiously, the icy chill replaced by an eerie silence. It's a natural gallery, with the walls lined with hulking shapes of ice, each meticulously sculpted into various forms and shapes, catching the refracting light in a stunningly beautiful yet alien way.

The air in here is somehow softer, less hostile. As your eyes adjust to the dazzling spectacle, you spot a large, carved pedestal at the end of the gallery. Standing on it is a gigantic, ornate paintbrush, the Sated Artist.

Treading cautiously between the sculptures, you feel an intense magnetic pull. As you reach the pedestal, you can feel the icy cold give way to a warming hum from the Sated Artist.

The brush is made of a material you cannot identify, and the bristles seem to shimmer with an unworldly gleam. You take a moment to appreciate the craftsmanship of the object before you, before extending your gloved hand towards it.

As you grip the Sated Artist, you notice it feels... alive, buzzing, eager to create. The icy walls around you suddenly don't seem so lifeless anymore. With a sense of purpose, you dip the Sated Artist into a nearby pool of black miasma ink that bubbles up from a fissure in the floor.

Holding the brush, you make an attempt to paint, dragging it through the air. It feels like drawing on an invisible canvas. The miasma ink solidifies mid-air into a three-dimensional object. You draw a small cube, watching in fascination as it hovers in the air before settling down gently onto the icy floor. It's weighty, similar to iron, but bears all the same characteristics of the ink.

You grasp the Sated Artist, now realizing that the surrounding sculptures weren't carved from ice but painted into existence. This glacial studio is essentially a memorial to an artist's timeless presence, a creator who used the Sated Artist to paint life into the ice.

Carefully stowing the Sated Artist into your pack, you step back into the brutal cold outside the ice gallery. The icy wilderness seems different now, no longer just a cold, harsh expanse but a canvas awaiting the touch of the Sated Artist.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Timekeeper's Keepsake [layer4]
<<CollectRelic $relic44>>\
<<if !setup.passingTime()>>

Off to your left, you notice an anomaly in this frost-bitten world - a giant mechanical sundial, half-buried in the snow, its large gnomon casting a long shadow despite the gloom. Surrounding the sundial are numerous metallic objects, suspended in mid-air, coated in thick ice, as if time had stopped for them eons ago.

Intrigued, you walk towards the sundial, leaving a trail of footprints on the unblemished snow. The static objects suspended in the air hum with an eerie energy that makes the air vibrate. You reach out tentatively, touching a metallic shard, and instantly, it's as if the suspended time itself resists your touch, repelling your gloved hand.

On instinct, you approach the center of the sundial where the gnomon stands firm. As you brush away the snow and ice, you reveal a hidden compartment. With a huff of effort, you pry it open to reveal the Timekeeper's Keepsake, the pocket watch. The metallic casing gleams in the dim light, seeming to pulse with temporal power.

You twist the watch, stopping its movement and immediately, the humming energy surrounding the objects wanes, the frozen tableau of suspended items shudder before they drop onto the snow, freed from their temporal imprisonment. You hastily pick up the pocket watch, its power released, allowing you to move it.

The cold suddenly seems to bite deeper, a reminder of the hostile environment you're in. You place the Timekeeper's Keepsake safely in your pocket, feeling the subtle tick-tock against your chest. It's as if time itself has taken a breath. As you trudge away from the ancient sundial, leaving the broken temporal field behind, the miasma-produced wind picks up once again, the snow begins to fall, and the Abyss's fourth layer reclaims its snowy monotony.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Creator's Bolt [layer4]
<<CollectRelic $relic45>>\
<<if !setup.passingTime()>>

Ahead, through the dense veil of fog, a glimmer catches your eye. You squint, straining your eyes, and trudge towards the flicker. Gradually, the silhouette of an enormous, frozen archway materializes from the fog, standing resolute amidst the bleak, snowy expanse. Carved into the ice, the archway is etched with countless intricate patterns of twisting, intertwining lines - they almost appear like the plotlines of a thousand different stories, a silent testimony to the countless tales born in the hearts of humans.

A low hum resonates from beneath the snow, a vibration barely perceptible but enough to instill a sense of deep awe and trepidation. Behind the archway, obscured by a whirl of snow and frost, stands a giant, translucent pedestal of pure ice. And there, held aloft, gleaming in the low light filtering through the icy ceiling, rests the Creator's Bolt.

The Bolt appears almost ghostly, its shimmering metallic surface adorned with a mesmerizing red gem. It's easy to see how this Relic could harbor the power to create media from a mere thought. You feel an odd sense of reverence; this Relic has the power to bring to life the deepest desires and emotions of anyone it passes through.

With a deep breath, you advance, your hands outstretched. As you draw nearer, a comforting warmth begins to radiate from the Bolt, defying the freezing surroundings. Reaching out, you carefully wrap your fingers around the Relic, expecting it to be solid. Instead, it slips right through your grasp like a specter. Startled, you remember its description; it can't interact with living flesh.

An idea forms in your mind. You take a sock out of your bag, and open it as a small container. Holding the sock open, you try to maneuver the Bolt into it. With a small thrill, the arrow sinks into the fabric. You quickly draw the sock closed, trapping the Relic inside. Now encased in an inanimate object, the Bolt is yours to command whenever you choose to do so.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Perpetual Repose [layer4]
<<CollectRelic $relic46>>\
<<if !setup.passingTime()>>

As you march on, a towering structure catches your eye — a glacial monolith, shimmering with a glacial blue light. Embedded in the glacier is a small, circular object. Upon closer inspection, you see it — the Perpetual Repose, its surface as smooth and untouched as the day it was forged. Its steadfast endurance, juxtaposed with the ice's fragility, only highlights its indomitable existence.

Your fingers graze the surface of the shield, but the ice is a bitter barrier, its cold bite causing your hand to recoil instinctively. Determination steeling your resolve, you carefully begin to chip away at the ice encasing the buckler. Each strike echoes across the icy expanse, a metronome in your quest.

The shield seems to absorb the shock from your strikes, the vibrations diffusing across its surface without leaving a mark. As the ice around the shield cracks and breaks away, you marvel at the sight—despite centuries spent in the harshest environment, the shield stands pristine.

As you hold the Perpetual Repose in your hands, feeling its inexplicable warmth against the biting cold, you can't help but appreciate the irony. Here, in the heart of an environment where everything is continuously eroded and destroyed, lies a Relic that refuses to yield.

The buckler is a fitting emblem of endurance against all odds, a symbol of the immutable spirit of the divers that brave the Abyss.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Toral Wave [layer4]
<<CollectRelic $relic47>>\
<<if !setup.passingTime()>>

Suddenly, the hair on your arms stand on end, and you feel the subtle prickling sensation of static electricity in the air. You know you're close. Your heart races with anticipation as you proceed towards the source of the electric disturbance. You tread carefully around a towering shard of ice, when a unique spectacle steals your attention.

You find yourself standing at the precipice of a deep crevasse. An intricate display of electric sparks lights up the chasm, weaving and winding their way around like the threads of an voltaic quilt. They dance and twirl, throwing a wild and captivating show of glimmering light. The source of this electrical phenomenon is nestled in the heart of the crevasse: a sleek, silver loop, the Toral Wave.

Carefully, you maneuver your way down into the crevasse. With each descent, you can feel the electricity grow stronger, your skin tingling, your heart pounding like a wild drum.

You reach the bottom of the crevasse, a dim world lit only by the flickering electricity of the Relic. The Toral Wave rests in the snow on the ground, pulsating with energy, casting an array of silver streaks across the icy walls of the chasm. It is breathtakingly beautiful and dangerously powerful.

You reach out to claim the Relic, and the moment your hand touches the Toral Wave, a strong jolt of energy surges through you, making you gasp. You can feel the energy, controlled yet chaotic, coursing through you before finally dissipating harmlessly into the ground.

<b>A source of electricity like this would be hard to use in combat, but perhaps if you had some way to safely channel it and fight with it then it could be more effective?</b>

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Pick up the Flamel's Folly [layer4]
<<CollectRelic $relic48>>\
<<if !setup.passingTime()>>

Ahead, through a veil of frost-tinted fog, you see an aberration in the natural landscape. A glacial formation, rising defiantly against the white expanse. Unlike the surrounding ice formations, this one glistens with a metallic sheen. It is a mountain, its height majestic, its form formidable, and its composition entirely alien.

You can see veins of <span style="color: #b87333;">copper</span> and <span style="color: silver;">silver</span> threading the glacial body, spreading out like an intricate spider web. A glacier of metal in a realm of ice. Despite the piercing cold, you venture closer.

As you draw nearer, you can see the glint of other metals too. Striations of <span style="color: gold;">gold</span>, blobs of <span style="color: #e5e4e2;">mercury</span> held captive within the steel-cold iron, speckles of <span style="color: gray;">titanium</span> and <span style="color: #7e7e80;">zinc</span>, all frozen and mixed together in a moment of chaotic splendor. The closer you get, the more you understand the metallic glacier is more than an anomaly; it is an echo of the Relic's nature.

The mountainside is sheer, a daunting climb even for a seasoned climber. But you are undeterred. You start your climb, bracing against the whipping wind, the chilled metal against your hands an unusual contrast to the ice you'd been so accustomed to.

As you climb higher, the variety of metals changes. Now you can see rare, precious metals - <span style="color: #d8c0d8;">palladium</span>, <span style="color: #e5e4e2;">platinum</span>, and a hint of what could be <span style="color: silver;">rhodium</span>. Their appearance sparks a thought: Could the Relic's effect have caused this?

Your hands reach a small crevasse, offering a much-needed respite from the climb. Hidden within the shadowy recess, you find it. Flamel's Folly. The rod is tucked away, its length obscured in the shadows. It's cool to the touch, yet the connection ignites a sense of power within you.

With the Relic safely secured, you begin to make your way back down the mountain of metal and continue on your expedition.

<<nobr>>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Relics">Continue searching for the Relics of layer 4</button>
    </div>
    <div class="menu-item">
        <button class="dark-btn obsidian" data-passage="Layer4 Hub">Continue exploring the fourth layer</button>
    </div>
<</nobr>>
<</if>>


:: Layer4 Travel Events [layer4 nobr]
<<set _triggers = {
	driftingSwallower: () => !$voidDiamondActive && $timeL4T1 >= 7,
}>>

<<PassTime _triggers>>

<<if _triggers.driftingSwallower()>>
	<br>A great hissing sound, as if a blimp were leaking its helium, fills your ears as a dark form descends on you from above. A monstrous beast floats above your head and unveils its tentacles in preparation of its attempt to shovel you into its enormous maw.<br><br>

	<button class="dark-btn obsidian" data-passage="Layer4 Threat1" data-setter="$returnPassage = passage()">Deal with the Drifting Swallower</button><br>
<</if>>


:: Layer4 Ascend2 [layer4]
<<nobr>>
<<if !setup.passingTime()>>
	<<set _multiplier = 1>>
	<<if $DaedalusFly || $mechaBoarded>>
		<<set _multiplier = 1/2>>
		<<if $DaedalusFly && !$mechaBoarded>>
			<<include "Companions Stranded">>
		<</if>>
	<</if>>
	<<StartTraveling 7 0 _multiplier>>
<</if>>
<<PassTimeWithEvents>>
<</nobr>>\
<<if !setup.passingTime()>>
	<<nobr>>
		<<if !$voidDiamondActive>>
			<<set $corruption -= $currentModifiedAscensionCost>>
		<</if>>
		<<if !$ascendedLayers.includes($currentLayer)>>
    		<<set $ascendedLayers.push($currentLayer)>>
		<</if>>
	<</nobr>>
	You continue your hike and try to keep somewhat warm despite the bone-chilling cold, but eventually the temperature starts to rise. However, once you've gotten to the comfortable warmth of the cave systems, you find the light is once again disappearing, leaving you in the dim darkness of the third layer.

	<<include "Curse Descriptions">>
	<<if $TwinFly>>
		<<include "Twin rejoin">>
	<</if>>
	<button class="dark-btn obsidian" data-passage="Layer3 Hub">Return to the third layer</button>
<</if>>


:: Layer4 Exit2 [layer4]
<<PassTimeWithEvents>>\
<<if !setup.passingTime()>>
	You continue your hike and try to keep somewhat warm despite the bone-chilling cold and your treacherous journey along the pit of sheer ice. As you get closer to the bottom, the temperature rises and the air starts to dry out.

	<<include "Curse Descriptions">>

	<button class="dark-btn obsidian" data-passage="Layer5 1">Continue to the fifth layer</button>
<</if>>


:: Layer4 Cherry Relic [layer4]
<<nobr>>
<<set $temp1 = random(0,14) + 33>>
<<set $temp2 = random(0,14) + 33>>
<<for $i = 0; $i < 1; $i>>
	<<set $temp2 = random(0,14) + 33>>
	<<if $temp1 !== $temp2>>
		<<break>>
	<</if>>
<</for>>
<<set $ownedRelics.push($relics[$temp1])>>

<<set $corruption -= Math.floor(Math.max(($relics[$temp1].corr / 2) - $corRed, 0))>>
<<set $ownedRelics.push($relics[$temp2])>>

<<set $corruption -= Math.floor(Math.max(($relics[$temp2].corr / 2) - $corRed, 0))>>
<</nobr>>

The Relics you have found with Cherry's Chaotic Luck are $relics[$temp1].name and $relics[$temp2].name for a cost of <<print Math.floor(Math.max(($relics[$temp1].corr / 2) - $corRed, 0))>> and <<print Math.floor(Math.max(($relics[$temp2].corr / 2) - $corRed, 0))>> corruption respectively.

<button class="dark-btn obsidian" data-passage="Layer4 Spectre">Continue on to the rest of the layer</button>

:: Layer4 Cherry Curse [layer4]
<<nobr>>
<<set _temp1 = random(0,15) + 40>>
<<set _temp2 = random(0,15) + 40>>
<<for _i = 0; _i < 1; _i>>
	<<set _temp1 = random(0,15) + 40>>
	<<set _temp2 = random(0,15) + 40>>
	<<if (_temp1 !== _temp2) && (_temp1 + _temp2 !== 43 && (Math.abs(_temp1 - _temp2) !== 1) && !($mc.hasCurse(ShrunkenAssets) && (_temp1 === 42 || _temp2 === 42)))>>
		<<break>>
	<</if>>
<</for>>

<<set _curse1 = setup.curseByNum(_temp1)>>
<<set _curse2 = setup.curseByNum(_temp2)>>
<<set _curse1.corr = Math.round(Math.max((_curse1.corr * 3 / 2), 0))>>
<<set _curse2.corr = Math.round(Math.max((_curse2.corr * 3 / 2), 0))>>
<<set $mc.addCurse(_curse1)>>
<<set $mc.addCurse(_curse2)>>
<<set $corruption += _curse1.corr>>
<<set $corruption += _curse2.corr>>
<</nobr>>

The Curses you have obtained with Cherry's Chaotic Luck are _curse1.name and _curse2.name for a cost of _curse1.corr and _curse2.corr corruption respectively.
<<set _hasScales = (_scaleCurse = _curse1).name === "Tipping the Scales" || (_scaleCurse = _curse2).name === "Tipping the Scales">>\
<<if _hasScales>>

Please enter your new scale color:

<<textbox "_scaleCurse.scaleColor" "green" "Layer4 Spectre">>

<<else>>
<button class="dark-btn obsidian" data-passage="Layer4 Spectre">Continue on to the rest of the layer</button>
<</if>>


:: Layer4 Cherry Mix [layer4]
<<nobr>>
<<set $temp1 = random(0,14) + 33>>
<<set $temp2 = random(0,15) + 40>>
<<for $i = 0; $i < 1; $i>>
	<<set $temp2 = random(0,15) + 40>>
	<<if !($mc.hasCurse(ShrunkenAssets) && $temp2 === 42)>>
		<<break>>
	<</if>>
<</for>>
<<set $ownedRelics.push($relics[$temp1])>>

<<set $corruption -= Math.floor(Math.max(($relics[$temp1].corr / 2) - $corRed, 0))>>
<<set _curse = setup.curseByNum($temp2)>>
<<set $mc.addCurse(_curse)>>
<<set _curse.corr = Math.round(Math.max((_curse.corr * 1.5), 0))>>
<<set $corruption += _curse.corr>>
<</nobr>>

With Cherry's Chaotic Luck you have found the Relic $relics[$temp1].name for a cost of <<print Math.floor(Math.max(($relics[$temp1].corr / 2) - $corRed, 0))>> corruption and obtained the Curse _curse.name for a gain of _curse.corr corruption respectively.

<<if $mc.hasCurse("Tipping the Scales")>>\
Please enter your new scale color:

<<textbox "$mc.skinColor" "green" "Layer4 Hub">>

<<else>>

<button class="dark-btn obsidian" data-passage="Layer4 Spectre">Continue on to the rest of the layer</button>

<</if>>


:: Layer4 Curses Random [nobr]
<<set _tempCurses = setup.cursesOnLayer[4]>>
<<set _totalCurses = $mc.curses>>
<<for _i=0; _i< $hiredCompanions.length; _i++>>
	<<set _totalCurses = _totalCurses.concat($hiredCompanions[_i].curses)>>
<</for>>
<<include "Curse Randomizer">>

:: Escape Balloon L4 [layer4]
<<nobr>><<set $currentLayer = 4>><<if !isPlaying("layer4")>>
	<<masteraudio stop>><<audio "layer4" volume 0.2 play loop>>
<</if>><</nobr>>
The chills of this layer don't seem to abate one bit when you aren't on the ground. You do feel a bit of relief to move rapidly through the enormous vertical tunnel at the lowest point of the ice though, rather than an agonizing climb through the steep cliffs and frozen tunnels.

<<nobr>>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Escape Balloon L3" data-setter="$corruption -= (35 - $corRed)">Ascend to next layer</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Curses">Hover on this layer to take in a Curse</button>
</div>
<div class="menu-item">
<button class="dark-btn obsidian" data-passage="Layer4 Hub" data-setter="$escBalDepl=0">Get off the balloon on this layer</button>
</div>
<</nobr>>


:: Layer4 Preview [image layer4]
As you bring the charm up to your eye and gaze deep into the red crystal, your vision fades and a new image comes clearly into view:

[img[setup.ImagePath+'Layer Intros/l4intro.png']]

@@.layerTitle;LAYER 4 - HOARFROST WASTES@@

You see yourself trudging through thick layers of snow, and even with only your sight to view the layer, a deep sense of chills runs through you, as if the cold here were able to seep into your very being. Suddenly the image shifts and you see the splendor that you could find on this layer.

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-relics.png']]

As an image of the wonders you might find on this layer starts to come into focus, an intense feeling of humility washes through you.

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-wonders.png']]

The mystical possibilities of the wonders fade from your view and you suddenly feel nauseous, as if a huge amount of miasma was suddenly sucked into your chest. You visualize the corruptions and Curses that may afflict you in the layer below.

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-curses.png']]

Finally the nauseous feeling passes but is replaced by a brief sense of terror as you get a glimpse of the threats that await you on the layer.

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-threats.png']]

Finally, the vision fades, leaving you standing once again where you were before, with only a brief sense of motion sickness as you orient yourself back to your physical body. As you look at the Gleam Dazer once again, you notice the Relic is cracked and broken.

<button class="dark-btn obsidian" data-passage="$previewReturn" data-setter="setup.loseRelic('Gleam Dazer')">Return</button>

:: Layer4 notes [image layer4 noreturn]

Relics:

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-relics.png']]

Wonders:

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-wonders.png']]

Curses: 

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-curses.png']]

Threats: 

[img[setup.ImagePath+'Clipped-Fin/Abyss Diver Page 5-threats.png']]

<button class="dark-btn obsidian" onclick="SugarCube.State.backward()">Back</button>

:: Layer4 Camp

<<nobr>>
<h1>Camping</h1>

<<set _random = random(1,4)>>
<<if _random === 1>>
[img[setup.ImagePath+'Environments/Layer4Landscape1.png']]
<<elseif _random === 2>>
[img[setup.ImagePath+'Environments/Layer4Landscape2.png']]
<<elseif _random === 3>>
[img[setup.ImagePath+'Environments/Layer4Landscape3.png']]
<<else>>
[img[setup.ImagePath+'Environments/Layer4Landscape4.png']]
<</if>>
<</nobr>>

<<include 'CampCode'>>

:: Layer4 Threat1 [layer4]
<<set $timeL4T1 -= 7>>
[img[setup.ImagePath+'Threats/driftingswallower.png']]

The beast moves gracefully, its tail and powerful appendages weaving through the air like tendrils of a living nightmare. Its presence is a chilling reminder of the dangers lurking in this seemingly serene layer of the Abyss.

The Drifting Swallower, sensing your movements, turns its attention towards you. Its appendages propel it forward with surprising speed, closing the distance between you in a matter of seconds. Your heart races as you fumble for your weapon, knowing that a mere five bullets could bring this creature to its end.

As the beast swoops down upon you, you observe its immense size and imagine the feeling of its slick, cold flesh skimming against your skin send shivers down your spine. Your body, unprepared for the sudden assault, trembles with a mix of fear and adrenaline.

How do you want to deal with the creature descending upon you?


<<nobr>>
<<if $items[14].count > 0 && $hiredCompanions.some(e => e.id === setup.companionIds.khemia)>>
	Khemia has enough expertise with a blade to be able to fight it off, but even he would be seriously injured in the process, increasing your next 6 travel times by 1 day each if you let him fight for you.<br>
	<button class="dark-btn obsidian" data-passage="$returnPassage" data-setter="$status.duration += (6 - $statRed); $status.penalty += 1; $smaragdineThreatsSubmitted.swallower = true; $smaragdineThreatsDefeated.swallower = true">Have Khemia fight it off with a sword</button><br><br>
<</if>>
<<if ($joyousSword === 1 || $ownedRelics.some(e => e.name === "Sunbeam")) && $hiredCompanions.some(e => e.id === setup.companionIds.khemia)>>
	With a powerful Relic sword in hand, Khemia can defeat the Drifting Swallower without any major issues after an intense battle.<br>
	<button class="dark-btn obsidian" data-passage="$returnPassage" data-setter="$smaragdineThreatsDefeated.swallower = true">Allow Khemia to defeat it with his Relic blade</button><br><br>
<</if>>
<<if $items[13].count > 0 && $items[20].count > 4>>
	You can take it down effectively with a gun, but you'll need at least 5 bullets to take it down due to its evasive movements.<br>
	[[Shoot it with your pistol|$returnPassage][$items[20].count -= (5 - $bullRed); $smaragdineThreatsDefeated.swallower = true]]<br><br>
<</if>>
	<<if $slingshot === 1>>
	Your Brave Vector slingshot can be used like a gun, and a ranged weapon can efficiently bring down a swallower.<br>
	<button class="dark-btn obsidian" data-passage="$returnPassage" data-setter="$smaragdineThreatsDefeated.swallower = true">Defeat it with the Brave Vector</button><br><br>
<</if>>
<<if $ownedRelics.some(e => e.name === "Tranquility Knell")>>
	The Drifting Swallower detects its prey by sensing vibrations, but the Tranquility Knell silences noise in the air and other media, nearly eliminating vibrations and leaving the creature virtually blind. This effect should provide you with a 30-minute window where the Swallower is unable to find you, allowing you to escape unnoticed until you are out of range.<br>
	<button class="dark-btn obsidian" data-passage="$returnPassage" data-setter="$smaragdineThreatsDefeated.swallower = true">Escape with the Tranquility Knell</button><br><br>
<</if>>
<<if $mechaBoarded>>
	The Drifting Swallower looks imposing even from the mecha you're currently in. However, it should still be no match.<br>
	<button class="dark-btn obsidian" data-passage="$returnPassage" data-setter="$smaragdineThreatsDefeated.swallower = true">Activate the plasma cannons and shoot it down</button><br><br>
<</if>>

<<if $ownedRelics.some(e => e.name === "Creepy Doll")>>
	As the creature descends, a childlike, otherworldly voice whispers to you, its origin both elusive and omnipresent.<br><br>
	<<if ($hiredCompanions.length < 1 || ($hiredCompanions.some(e => e.id === setup.companionIds.golem) && $hiredCompanions.length < 2 ))>>
		<<say $creepydoll>>Don't be afraid, nobody's going to hurt you. Just hold me tight, and all the bad things will go away! <</say>><br>

		A gentle, comforting warmth emanates from the Creepy Doll, beckoning you to embrace it and welcome its presence into your heart.<br><br>

		<<LinkButton "Hug the doll tightly and close your eyes" $returnPassage "dark-btn obsidian">>
			<<dollTF>>
		<</LinkButton>><br><br>
	<<else>>
		<<say $creepydoll>> Wouldn't you just rather play with just me? I can make all bad things go away if its just the two of us!<</say>><br><br>
	<</if>>
<</if>>

If you allow it to overpower you, prepare to be vored! It will swallow you whole and you will spend the next 3 days inside of its large stomach being tickled and lightly burned by gastric juices enveloping your entire body. After you are eventually expelled from the creature, you'll be left with persistent light burns, increasing all travel costs by 1 day until you are cured. This will not heal without a medkit.<br>
<button class="dark-btn obsidian" data-passage="Layer4 Swallower Ravage" data-setter="$status.duration += 99; $status.penalty += 1; $smaragdineThreatsSubmitted.swallower = true">Allow it to overpower you</button>
<</nobr>>

Use the following option only if you have specifically considered your inventory and made a plan of how to use what you have to take down the creature.
<button class="dark-btn obsidian" data-passage="$returnPassage">Use a combination of Relics not mentioned above you believe would be able to overpower one of the beasts</button>


:: Layer4 Swallower Ravage [layer4]

[img[setup.ImagePath+'Threats/driftingswallower.png']]

As the Drifting Swallower closes in, you make no effort to evade it or reach for your weapon. Instead, you stand still, offering yourself willingly to the creature. The beast hesitates for a brief moment, as if surprised by your lack of resistance, before its slick, cold flesh makes contact with your body, sending shivers down your spine.

You are engulfed by the creature, its cavernous maw swallowing you whole. The moist, warm air inside the beast's mouth envelops you as the strong, musky scent of its saliva fills your nostrils. Its massive tongue wraps around you, its slick surface covered in tiny, writhing taste buds that explore every inch of your skin, leaving a trail of sticky saliva in their wake.

The sensation of being enclosed within the creature's mouth, the rhythmic pulsing of its throat as it swallows, and the gentle suction of its breath around you is both terrifying and undeniably exhilarating. With a final, powerful contraction, the tight, wet passage leads you to the beast's stomach.

As you slide into the Drifting Swallower's stomach, you land on a soft, cushion-like surface. The stomach walls are surprisingly warm, pulsating gently against your body with each of the creature's breaths. The air inside is humid and thick, carrying with it the pungent aroma of the beast's previous meals. Your senses are overwhelmed, the heady mixture of fear, excitement, and curiosity pushing you to the brink of sensory overload.

The stomach walls contract around you, moving in a slow, undulating rhythm that causes the gastric juices to lap at your most sensitive areas. The sensation is simultaneously ticklish and burning, as the potent digestive fluids seep through your clothing and make contact with your skin. The delicate balance of pleasure and pain intensifies with each passing moment, as the gastric juices tenderly lap and nibble at your body.

Through the darkness, you can hear the distant, muffled sounds of the creature's movements, a constant reminder that you're at the mercy of this massive beast. Your world has been reduced to the tight confines of its stomach, a space where you're both vulnerable and strangely secure.

As the hours pass, you find yourself slipping in and out of consciousness, the mixture of fear and sensory overload lulling you into a hazy, dreamlike state. You're acutely aware of every sensation, from the gentle, rhythmic pulsing of the stomach walls against your skin to the ever-present burning and tickling of the gastric juices that continue their relentless assault.

Three days later, the Drifting Swallower expels you from its body, leaving you battered and covered in light burns. You will increase all of your travel times by 1 day until you are healed.

<button class="dark-btn obsidian" data-passage="$returnPassage">Continue your journey through the Abyss</button>

:: Steady Shrine Site
<<PassTimeWithEvents>>\
<<if !setup.passingTime()>>\
<<= '<img src="' + setup.ImagePath + 'Wonders/steadyshrine1.png" class="half-size">' >>\
<<if !$hiredCompanions.length>>
	You must have companions if you would like to use the Steady Shrine.
<<elseif $skewedForced < 4>>
	<<if $ownedRelics.some(e => e.name === "Empathic Prism")>>\
	You can look through your Empathic Prism to see what Curses you currently have which might interact with your companions in some way.
	<button class="dark-btn obsidian" data-passage="Empathic Prism Shrine Check">Check your Empathic Prism to see what Curses would provoke special reactions from your companions</button>
	<</if>>\

	Would you like to use the Steady Shrine to copy a Curse onto one of your willing companions at the cost of <<print ($skewedUsed * 5)>> dubloons?
	<button class="dark-btn obsidian" data-passage="Layer4 Steady1a">Yes, use the Steady Shrine to copy a Curse</button>

	Would you like to use the Steady Shrine to force a Curse upon one of your unwilling companions at the cost of <<print ($skewedUsed * 5)>> dubloons?
	<button class="dark-btn obsidian" data-passage="Layer4 Steady 2a">Yes, use the Steady Shrine to forcibly copy a Curse</button>
	//There will likely be consequences.//
<<else>>
	None of your companions trust you at this shrine anymore. None will get close enough for you to use the shrine with them. They watch you with eyes full of fear and anger, as if they could bolt at any moment and leave you alone in the Abyss.
<</if>>

<button class="dark-btn obsidian" data-passage="Diver shrine">Visit the Diver shrine</button>

<button class="dark-btn obsidian" data-passage="Layer4 Hub">Return to exploring the fourth layer</button>
<</if>>

:: Layer4 Purity Seed [layer4]

<<= '<img src="' + setup.ImagePath + 'Wonders/purityseed.jpeg" class="half-size">' >>

Your gaze sweeps the ground, searching for any signs of life that might have survived. Then, nestled in a hollow at the base of the deceased tree, you spot something small and gleaming faintly against the snow. It's a single purity seed, encased in a thin layer of ice.

Gingerly, you retrieve the white seed, its snow white color almost indistinguishable from the surrounding frost, as the chill from the ice bites into your fingers. You wrap it carefully in a cloth, as if to protect it from the pervasive cold as much as possible, even though it is already frozen solid. But perhaps it's resilient enough to survive even in these conditions?

The wind picks up, reminding you to move once again. You turn back, the seed secured, as you prepare to bring it back to Emily.

<button class="dark-btn obsidian" data-passage="Purity Tree Site" data-setter="$hasPuritySeed = true">Continue your business at the Purity Tree</button>